<?xml version="1.0" encoding="UTF-8"?>
<job>
  <name>sta_crm_accounts_h</name>
  <description />
  <extended_description />
  <job_version />
  <job_status>0</job_status>
  <directory>/</directory>
  <created_user>-</created_user>
  <created_date>2018/04/24 15:31:25.724</created_date>
  <modified_user>-</modified_user>
  <modified_date>2018/04/24 15:31:25.724</modified_date>
  <parameters>
    <parameter>
      <name>op_time</name>
      <default_value>20170815</default_value>
      <description />
    </parameter>
  </parameters>
  <connection>
    <name>conn_edw</name>
    <server>${edw_database_ip}</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>${edw_database_name}</database>
    <port>${edw_database_port}</port>
    <username>${edw_username}</username>
    <password>${edw_passwd}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>EXTRA_OPTION_MYSQL.rewriteBatchedStatements</code>
        <attribute>true</attribute>
      </attribute>
      <attribute>
        <code>EXTRA_OPTION_MYSQL.useCompression</code>
        <attribute>true</attribute>
      </attribute>
      <attribute>
        <code>EXTRA_OPTION_MYSQL.useServerPrepStmts</code>
        <attribute>false</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${edw_database_port}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <slaveservers>
    </slaveservers>
  <job-log-table>
    <connection>conn_edw</connection>
    <schema />
    <table />
    <size_limit_lines />
    <interval />
    <timeout_days />
    <field>
      <id>ID_JOB</id>
      <enabled>Y</enabled>
      <name>ID_JOB</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>JOBNAME</name>
    </field>
    <field>
      <id>STATUS</id>
      <enabled>Y</enabled>
      <name>STATUS</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>STARTDATE</id>
      <enabled>Y</enabled>
      <name>STARTDATE</name>
    </field>
    <field>
      <id>ENDDATE</id>
      <enabled>Y</enabled>
      <name>ENDDATE</name>
    </field>
    <field>
      <id>LOGDATE</id>
      <enabled>Y</enabled>
      <name>LOGDATE</name>
    </field>
    <field>
      <id>DEPDATE</id>
      <enabled>Y</enabled>
      <name>DEPDATE</name>
    </field>
    <field>
      <id>REPLAYDATE</id>
      <enabled>Y</enabled>
      <name>REPLAYDATE</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>Y</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>EXECUTING_SERVER</id>
      <enabled>N</enabled>
      <name>EXECUTING_SERVER</name>
    </field>
    <field>
      <id>EXECUTING_USER</id>
      <enabled>N</enabled>
      <name>EXECUTING_USER</name>
    </field>
    <field>
      <id>START_JOB_ENTRY</id>
      <enabled>N</enabled>
      <name>START_JOB_ENTRY</name>
    </field>
    <field>
      <id>CLIENT</id>
      <enabled>N</enabled>
      <name>CLIENT</name>
    </field>
  </job-log-table>
  <jobentry-log-table>
    <connection>conn_edw</connection>
    <schema />
    <table />
    <timeout_days />
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>JOBNAME</id>
      <enabled>Y</enabled>
      <name>TRANSNAME</name>
    </field>
    <field>
      <id>JOBENTRYNAME</id>
      <enabled>Y</enabled>
      <name>STEPNAME</name>
    </field>
    <field>
      <id>LINES_READ</id>
      <enabled>Y</enabled>
      <name>LINES_READ</name>
    </field>
    <field>
      <id>LINES_WRITTEN</id>
      <enabled>Y</enabled>
      <name>LINES_WRITTEN</name>
    </field>
    <field>
      <id>LINES_UPDATED</id>
      <enabled>Y</enabled>
      <name>LINES_UPDATED</name>
    </field>
    <field>
      <id>LINES_INPUT</id>
      <enabled>Y</enabled>
      <name>LINES_INPUT</name>
    </field>
    <field>
      <id>LINES_OUTPUT</id>
      <enabled>Y</enabled>
      <name>LINES_OUTPUT</name>
    </field>
    <field>
      <id>LINES_REJECTED</id>
      <enabled>Y</enabled>
      <name>LINES_REJECTED</name>
    </field>
    <field>
      <id>ERRORS</id>
      <enabled>Y</enabled>
      <name>ERRORS</name>
    </field>
    <field>
      <id>RESULT</id>
      <enabled>Y</enabled>
      <name>RESULT</name>
    </field>
    <field>
      <id>NR_RESULT_ROWS</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_ROWS</name>
    </field>
    <field>
      <id>NR_RESULT_FILES</id>
      <enabled>Y</enabled>
      <name>NR_RESULT_FILES</name>
    </field>
    <field>
      <id>LOG_FIELD</id>
      <enabled>N</enabled>
      <name>LOG_FIELD</name>
    </field>
    <field>
      <id>COPY_NR</id>
      <enabled>N</enabled>
      <name>COPY_NR</name>
    </field>
  </jobentry-log-table>
  <channel-log-table>
    <connection>conn_edw</connection>
    <schema />
    <table />
    <timeout_days />
    <field>
      <id>ID_BATCH</id>
      <enabled>Y</enabled>
      <name>ID_BATCH</name>
    </field>
    <field>
      <id>CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>CHANNEL_ID</name>
    </field>
    <field>
      <id>LOG_DATE</id>
      <enabled>Y</enabled>
      <name>LOG_DATE</name>
    </field>
    <field>
      <id>LOGGING_OBJECT_TYPE</id>
      <enabled>Y</enabled>
      <name>LOGGING_OBJECT_TYPE</name>
    </field>
    <field>
      <id>OBJECT_NAME</id>
      <enabled>Y</enabled>
      <name>OBJECT_NAME</name>
    </field>
    <field>
      <id>OBJECT_COPY</id>
      <enabled>Y</enabled>
      <name>OBJECT_COPY</name>
    </field>
    <field>
      <id>REPOSITORY_DIRECTORY</id>
      <enabled>Y</enabled>
      <name>REPOSITORY_DIRECTORY</name>
    </field>
    <field>
      <id>FILENAME</id>
      <enabled>Y</enabled>
      <name>FILENAME</name>
    </field>
    <field>
      <id>OBJECT_ID</id>
      <enabled>Y</enabled>
      <name>OBJECT_ID</name>
    </field>
    <field>
      <id>OBJECT_REVISION</id>
      <enabled>Y</enabled>
      <name>OBJECT_REVISION</name>
    </field>
    <field>
      <id>PARENT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>PARENT_CHANNEL_ID</name>
    </field>
    <field>
      <id>ROOT_CHANNEL_ID</id>
      <enabled>Y</enabled>
      <name>ROOT_CHANNEL_ID</name>
    </field>
  </channel-log-table>
  <pass_batchid>N</pass_batchid>
  <shared_objects_file />
  <entries>
    <entry>
      <name>START</name>
      <description />
      <type>SPECIAL</type>
      <start>Y</start>
      <dummy>N</dummy>
      <repeat>N</repeat>
      <schedulerType>0</schedulerType>
      <intervalSeconds>0</intervalSeconds>
      <intervalMinutes>60</intervalMinutes>
      <hour>12</hour>
      <minutes>0</minutes>
      <weekDay>1</weekDay>
      <DayOfMonth>1</DayOfMonth>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>96</xloc>
      <yloc>32</yloc>
    </entry>
    <entry>
      <name>成功</name>
      <description />
      <type>SUCCESS</type>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>864</xloc>
      <yloc>336</yloc>
    </entry>
    <entry>
      <name>[STEP1]:识别当日新增数据</name>
      <description />
      <type>SQL</type>
      <sql>##--[STEP1]:识别当日新增数据 - 创建临时表SDA_CRM_ACCOUNTS_H_INS，存储当日新增数据

##----[STEP1.1] - 创建临时表SDA_CRM_ACCOUNTS_H_INS
DROP TABLE IF EXISTS sda_crm_accounts_h_ins;
CREATE TABLE sda_crm_accounts_h_ins LIKE sda_crm_accounts_h;

##----[STEP1.2] - CRM_CD库新增数据写入SDA_CRM_ACCOUNTS_H_INS表
INSERT INTO sda_crm_accounts_h_ins
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,idcardno_address
)
SELECT 
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    

    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                                
    ,nd.name                                                   AS  name                              
    ,nd.date_entered                                           AS  date_entered                      
    ,nd.date_modified                                          AS  date_modified                     
    ,nd.modified_user_id                                       AS  modified_user_id                  
    ,nd.assigned_user_id                                       AS  assigned_user_id                  
    ,nd.created_by                                             AS  created_by                        
    ,nd.description                                            AS  description                       
    ,nd.deleted                                                AS  deleted                           
    ,nd.assigned_dept_id                                       AS  assigned_dept_id                  
    ,nd.readed_sign                                            AS  readed_sign                       
    ,nd.assigned_user_time                                     AS  assigned_user_time                
    ,nd.first_name                                             AS  first_name                        
    ,nd.last_name                                              AS  last_name                         
    ,nd.gender                                                 AS  gender                            
    ,nd.company                                                AS  company                           
    ,nd.search_code                                            AS  search_code                       
    ,nd.phone_mobile1                                          AS  phone_mobile1                     
    ,nd.phone_mobile2                                          AS  phone_mobile2                     
    ,nd.phone_home1_code                                       AS  phone_home1_code                  
    ,nd.phone_home1                                            AS  phone_home1                       
    ,nd.phone_home1_no                                         AS  phone_home1_no                    
    ,nd.phone_home2_code                                       AS  phone_home2_code                  
    ,nd.phone_home2                                            AS  phone_home2                       
    ,nd.phone_home2_no                                         AS  phone_home2_no                    
    ,nd.phone_fax_code                                         AS  phone_fax_code                    
    ,nd.phone_fax                                              AS  phone_fax                         
    ,nd.phone_fax_no                                           AS  phone_fax_no                      
    ,nd.qq                                                     AS  qq                                
    ,nd.mail_address                                           AS  mail_address                      
    ,nd.msn                                                    AS  msn                               
    ,nd.primary_address_street                                 AS  primary_address_street            
    ,nd.primary_address_city                                   AS  primary_address_city              
    ,nd.primary_address_zone                                   AS  primary_address_zone              
    ,nd.primary_address_plot                                   AS  primary_address_plot              
    ,nd.alt_address_street                                     AS  alt_address_street                
    ,nd.alt_address_city                                       AS  alt_address_city                  
    ,nd.alt_address_zone                                       AS  alt_address_zone                  
    ,nd.alt_address_plot                                       AS  alt_address_plot                  
    ,nd.going                                                  AS  going                             
    ,nd.birthdate                                              AS  birthdate                         
    ,nd.idcardno                                               AS  idcardno                          
    ,nd.credit_status                                          AS  credit_status                     
    ,nd.credit_desc                                            AS  credit_desc                       
    ,nd.flowing_water                                          AS  flowing_water                     
    ,nd.industry                                               AS  industry                          
    ,nd.area                                                   AS  area                              
    ,nd.registration_time                                      AS  registration_time                 
    ,nd.operation_time                                         AS  operation_time                    
    ,nd.year_income                                            AS  year_income                       
    ,nd.profit_rate                                            AS  profit_rate                       
    ,nd.stock_value                                            AS  stock_value                       
    ,nd.account_source1                                        AS  account_source1                   
    ,nd.account_source2                                        AS  account_source2                   
    ,nd.campaign_id                                            AS  campaign_id                       
    ,nd.parent_type                                            AS  parent_type                       
    ,nd.parent_id                                              AS  parent_id                         
    ,nd.account_value                                          AS  account_value                     
    ,nd.life_cycle                                             AS  life_cycle                        
    ,nd.date_cycle_start                                       AS  date_cycle_start                  
    ,nd.second_sales_possibility                               AS  second_sales_possibility          
    ,nd.maintenance_policy                                     AS  maintenance_policy                
    ,nd.status                                                 AS  status                            
    ,nd.recent_stranded_date                                   AS  recent_stranded_date              
    ,nd.first_call_datetime                                    AS  first_call_datetime               
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime            
    ,nd.last_call_datetime                                     AS  last_call_datetime                
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime             
    ,nd.next_call_datetime                                     AS  next_call_datetime                
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime             
    ,nd.next_contact_datetime                                  AS  next_contact_datetime             
    ,nd.total_call_count                                       AS  total_call_count                  
    ,nd.total_meeting_count                                    AS  total_meeting_count               
    ,nd.final_contact_datetime                                 AS  final_contact_datetime            
    ,nd.info_deadline                                          AS  info_deadline                     
    ,nd.manager_deadline                                       AS  manager_deadline                  
    ,nd.change_manager_deadline                                AS  change_manager_deadline           
    ,nd.dept_deadline                                          AS  dept_deadline                     
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline                
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign     
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign        
    ,nd.number                                                 AS  number                            
    ,nd.property_prove                                         AS  property_prove                    
    ,nd.stranded_user_id                                       AS  stranded_user_id                  
    ,nd.initial_user_id                                        AS  initial_user_id                   
    ,nd.initial_dept_id                                        AS  initial_dept_id                   
    ,nd.change_times                                           AS  change_times                      
    ,nd.main_number_field                                      AS  main_number_field                 
    ,nd.unicode_id                                             AS  unicode_id                        
    ,nd.is_private                                             AS  is_private                        
    ,nd.cancel_sign                                            AS  cancel_sign                       
    ,nd.date_created                                           AS  date_created                      
    ,nd.activation_count                                       AS  activation_count                  
    ,nd.boss_sign                                              AS  boss_sign                         
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime          
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime         
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline              
    ,nd.contact_policy                                         AS  contact_policy                    
    ,nd.is_recovery                                            AS  is_recovery                       
    ,nd.2013_3_sign                                            AS  2013_3_sign                       
    ,nd.source_type                                            AS  source_type                       
    ,nd.organize_id                                            AS  organize_id                       
    ,nd.domainFrom                                             AS  domainFrom                        
    ,nd.is_estate                                              AS  is_estate                         
    ,nd.estate_num                                             AS  estate_num                        
    ,nd.is_estate_project                                      AS  is_estate_project                 
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date       
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount     
    ,nd.is_car                                                 AS  is_car                            
    ,nd.car_num                                                AS  car_num                           
    ,nd.is_car_mortgage                                        AS  is_car_mortgage                   
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date         
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount       
    ,nd.is_car_full                                            AS  is_car_full                       
    ,nd.car_full_amaount                                       AS  car_full_amaount                  
    ,nd.by_car_date                                            AS  by_car_date                       
    ,nd.is_business_entity                                     AS  is_business_entity                
    ,nd.business_entity_water                                  AS  business_entity_water             
    ,nd.is_business_license                                    AS  is_business_license               
    ,nd.registration_date                                      AS  registration_date                 
    ,nd.no_business_license_date                               AS  no_business_license_date          
    ,nd.is_credit                                              AS  is_credit                         
    ,nd.credit_total_amount                                    AS  credit_total_amount               
    ,nd.credit_use_amount                                      AS  credit_use_amount                 
    ,nd.is_social_security                                     AS  is_social_security                
    ,nd.social_security_base                                   AS  social_security_base              
    ,nd.social_security_hand                                   AS  social_security_hand              
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund              
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base            
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand            
    ,nd.is_policy                                              AS  is_policy                         
    ,nd.year_month_pay                                         AS  year_month_pay                    
    ,nd.policy_type                                            AS  policy_type                       
    ,nd.policy_date                                            AS  policy_date                       
    ,nd.policy_amount                                          AS  policy_amount                     
    ,nd.is_history_project                                     AS  is_history_project                
    ,nd.history_project                                        AS  history_project                   
    ,nd.is_rejected_project                                    AS  is_rejected_project               
    ,nd.rejected_project_reason                                AS  rejected_project_reason           
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse            
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague         
    ,nd.is_know_project_relative                               AS  is_know_project_relative          
    ,nd.is_know_project_friend                                 AS  is_know_project_friend            
    ,nd.credit_total_overdue                                   AS  credit_total_overdue              
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue         
    ,nd.income_amount                                          AS  income_amount                     
    ,nd.business_entity                                        AS  business_entity                   
    ,nd.flowing                                                AS  flowing                           
    ,nd.nation                                                 AS  nation                            
    ,nd.education                                              AS  education                         
    ,nd.wedlock                                                AS  wedlock                           
    ,nd.income_source                                          AS  income_source                     
    ,nd.is_children                                            AS  is_children                       
    ,nd.is_verify                                              AS  is_verify                         
    ,nd.verify_user_id                                         AS  verify_user_id                    
    ,nd.verify_date                                            AS  verify_date                       
    ,nd.profession                                             AS  profession                        
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id              
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name            
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id              
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name            
    ,nd.purchase_type                                          AS  purchase_type                     
    ,nd.from_channels1_id                                      AS  from_channels1_id                 
    ,nd.from_channels1_name                                    AS  from_channels1_name               
    ,nd.from_channels2_id                                      AS  from_channels2_id                 
    ,nd.from_channels2_name                                    AS  from_channels2_name               
    ,nd.create_type                                            AS  create_type                       
    ,nd.idcardno_address                                       AS  idcardno_address                  

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_cd
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
LEFT JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）

WHERE
    od.id IS NULL                                              ##--ND有,OD无：即为新增
;

##----[STEP1.3] - CRM_BJ库新增数据写入SDA_CRM_ACCOUNTS_H_INS表
INSERT INTO sda_crm_accounts_h_ins
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id                               
    ,name                             
    ,date_entered                     
    ,date_modified                    
    ,modified_user_id                 
    ,assigned_user_id                 
    ,created_by                       
    ,description                      
    ,deleted                          
    ,assigned_dept_id                 
    ,readed_sign                      
    ,assigned_user_time               
    ,first_name                       
    ,last_name                        
    ,gender                           
    ,company                          
    ,search_code                      
    ,phone_mobile1                    
    ,phone_mobile2                    
    ,phone_home1_code                 
    ,phone_home1                      
    ,phone_home1_no                   
    ,phone_home2_code                 
    ,phone_home2                      
    ,phone_home2_no                   
    ,phone_fax_code                   
    ,phone_fax                        
    ,phone_fax_no                     
    ,qq                               
    ,mail_address                     
    ,msn                              
    ,primary_address_street           
    ,primary_address_city             
    ,primary_address_zone             
    ,primary_address_plot             
    ,alt_address_street               
    ,alt_address_city                 
    ,alt_address_zone                 
    ,alt_address_plot                 
    ,going                            
    ,birthdate                        
    ,idcardno                         
    ,credit_status                    
    ,credit_desc                      
    ,flowing_water                    
    ,industry                         
    ,area                             
    ,registration_time                
    ,operation_time                   
    ,year_income                      
    ,profit_rate                      
    ,stock_value                      
    ,account_source1                  
    ,account_source2                  
    ,campaign_id                      
    ,parent_type                      
    ,parent_id                        
    ,account_value                    
    ,life_cycle                       
    ,date_cycle_start                 
    ,second_sales_possibility         
    ,maintenance_policy               
    ,status                           
    ,recent_stranded_date             
    ,first_call_datetime              
    ,first_meeting_datetime           
    ,last_call_datetime               
    ,last_meeting_datetime            
    ,next_call_datetime               
    ,next_meeting_datetime            
    ,next_contact_datetime            
    ,total_call_count                 
    ,total_meeting_count              
    ,final_contact_datetime           
    ,info_deadline                    
    ,manager_deadline                 
    ,change_manager_deadline          
    ,dept_deadline                    
    ,lifecycle_deadline               
    ,accountinfo_completeness_sign    
    ,opptinfo_completeness_sign       
    ,number                           
    ,property_prove                   
    ,stranded_user_id                 
    ,initial_user_id                  
    ,initial_dept_id                  
    ,change_times                     
    ,main_number_field                
    ,unicode_id                       
    ,is_private                       
    ,cancel_sign                      
    ,date_created                     
    ,activation_count                 
    ,boss_sign                        
    ,cti_last_callin_datetime         
    ,cti_last_callout_datetime        
    ,cti_contact_deadline             
    ,contact_policy                   
    ,is_recovery                      
    ,2013_3_sign                      
    ,source_type                      
    ,organize_id                      
    ,domainFrom                       
    ,is_estate                        
    ,estate_num                       
    ,is_estate_project                
    ,monthly_house_payments_date      
    ,monthly_house_payments_amount    
    ,is_car                           
    ,car_num                          
    ,is_car_mortgage                  
    ,monthly_car_payments_date        
    ,monthly_car_payments_amount      
    ,is_car_full                      
    ,car_full_amaount                 
    ,by_car_date                      
    ,is_business_entity               
    ,business_entity_water            
    ,is_business_license              
    ,registration_date                
    ,no_business_license_date         
    ,is_credit                        
    ,credit_total_amount              
    ,credit_use_amount                
    ,is_social_security               
    ,social_security_base             
    ,social_security_hand             
    ,is_accumulation_fund             
    ,accumulation_fund_base           
    ,accumulation_fund_hand           
    ,is_policy                        
    ,year_month_pay                   
    ,policy_type                      
    ,policy_date                      
    ,policy_amount                    
    ,is_history_project               
    ,history_project                  
    ,is_rejected_project              
    ,rejected_project_reason          
    ,is_know_project_spouse           
    ,is_know_project_colleague        
    ,is_know_project_relative         
    ,is_know_project_friend           
    ,credit_total_overdue             
    ,credit_continuous_overdue        
    ,income_amount                    
    ,business_entity                  
    ,flowing                          
    ,nation                           
    ,education                        
    ,wedlock                          
    ,income_source                    
    ,is_children                      
    ,is_verify                        
    ,verify_user_id                   
    ,verify_date                      
    ,profession                       
    ,purchase_channel1_id             
    ,purchase_channel1_name           
    ,purchase_channel2_id             
    ,purchase_channel2_name           
    ,purchase_type                    
    ,from_channels1_id                
    ,from_channels1_name              
    ,from_channels2_id                
    ,from_channels2_name              
    ,create_type                      
    ,assigned_user_id_bak             
    ,assigned_dept_id_bak             
    ,idcardno_address                 
    
)   
SELECT
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    

    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                                                
    ,nd.name                                                   AS  name                                
    ,nd.date_entered                                           AS  date_entered                        
    ,nd.date_modified                                          AS  date_modified                       
    ,nd.modified_user_id                                       AS  modified_user_id                    
    ,nd.assigned_user_id                                       AS  assigned_user_id                    
    ,nd.created_by                                             AS  created_by                          
    ,nd.description                                            AS  description                         
    ,nd.deleted                                                AS  deleted                             
    ,nd.assigned_dept_id                                       AS  assigned_dept_id                    
    ,nd.readed_sign                                            AS  readed_sign                         
    ,nd.assigned_user_time                                     AS  assigned_user_time                  
    ,nd.first_name                                             AS  first_name                          
    ,nd.last_name                                              AS  last_name                           
    ,nd.gender                                                 AS  gender                              
    ,nd.company                                                AS  company                             
    ,nd.search_code                                            AS  search_code                         
    ,nd.phone_mobile1                                          AS  phone_mobile1                       
    ,nd.phone_mobile2                                          AS  phone_mobile2                       
    ,nd.phone_home1_code                                       AS  phone_home1_code                    
    ,nd.phone_home1                                            AS  phone_home1                         
    ,nd.phone_home1_no                                         AS  phone_home1_no                      
    ,nd.phone_home2_code                                       AS  phone_home2_code                    
    ,nd.phone_home2                                            AS  phone_home2                         
    ,nd.phone_home2_no                                         AS  phone_home2_no                      
    ,nd.phone_fax_code                                         AS  phone_fax_code                      
    ,nd.phone_fax                                              AS  phone_fax                           
    ,nd.phone_fax_no                                           AS  phone_fax_no                        
    ,nd.qq                                                     AS  qq                                  
    ,nd.mail_address                                           AS  mail_address                        
    ,nd.msn                                                    AS  msn                                 
    ,nd.primary_address_street                                 AS  primary_address_street              
    ,nd.primary_address_city                                   AS  primary_address_city                
    ,nd.primary_address_zone                                   AS  primary_address_zone                
    ,nd.primary_address_plot                                   AS  primary_address_plot                
    ,nd.alt_address_street                                     AS  alt_address_street                  
    ,nd.alt_address_city                                       AS  alt_address_city                    
    ,nd.alt_address_zone                                       AS  alt_address_zone                    
    ,nd.alt_address_plot                                       AS  alt_address_plot                    
    ,nd.going                                                  AS  going                               
    ,nd.birthdate                                              AS  birthdate                           
    ,nd.idcardno                                               AS  idcardno                            
    ,nd.credit_status                                          AS  credit_status                       
    ,nd.credit_desc                                            AS  credit_desc                         
    ,nd.flowing_water                                          AS  flowing_water                       
    ,nd.industry                                               AS  industry                            
    ,nd.area                                                   AS  area                                
    ,nd.registration_time                                      AS  registration_time                   
    ,nd.operation_time                                         AS  operation_time                      
    ,nd.year_income                                            AS  year_income                         
    ,nd.profit_rate                                            AS  profit_rate                         
    ,nd.stock_value                                            AS  stock_value                         
    ,nd.account_source1                                        AS  account_source1                     
    ,nd.account_source2                                        AS  account_source2                     
    ,nd.campaign_id                                            AS  campaign_id                         
    ,nd.parent_type                                            AS  parent_type                         
    ,nd.parent_id                                              AS  parent_id                           
    ,nd.account_value                                          AS  account_value                       
    ,nd.life_cycle                                             AS  life_cycle                          
    ,nd.date_cycle_start                                       AS  date_cycle_start                    
    ,nd.second_sales_possibility                               AS  second_sales_possibility            
    ,nd.maintenance_policy                                     AS  maintenance_policy                  
    ,nd.status                                                 AS  status                              
    ,nd.recent_stranded_date                                   AS  recent_stranded_date                
    ,nd.first_call_datetime                                    AS  first_call_datetime                 
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime              
    ,nd.last_call_datetime                                     AS  last_call_datetime                  
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime               
    ,nd.next_call_datetime                                     AS  next_call_datetime                  
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime               
    ,nd.next_contact_datetime                                  AS  next_contact_datetime               
    ,nd.total_call_count                                       AS  total_call_count                    
    ,nd.total_meeting_count                                    AS  total_meeting_count                 
    ,nd.final_contact_datetime                                 AS  final_contact_datetime              
    ,nd.info_deadline                                          AS  info_deadline                       
    ,nd.manager_deadline                                       AS  manager_deadline                    
    ,nd.change_manager_deadline                                AS  change_manager_deadline             
    ,nd.dept_deadline                                          AS  dept_deadline                       
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline                  
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign       
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign          
    ,nd.number                                                 AS  number                              
    ,nd.property_prove                                         AS  property_prove                      
    ,nd.stranded_user_id                                       AS  stranded_user_id                    
    ,nd.initial_user_id                                        AS  initial_user_id                     
    ,nd.initial_dept_id                                        AS  initial_dept_id                     
    ,nd.change_times                                           AS  change_times                        
    ,nd.main_number_field                                      AS  main_number_field                   
    ,nd.unicode_id                                             AS  unicode_id                          
    ,nd.is_private                                             AS  is_private                          
    ,nd.cancel_sign                                            AS  cancel_sign                         
    ,nd.date_created                                           AS  date_created                        
    ,nd.activation_count                                       AS  activation_count                    
    ,nd.boss_sign                                              AS  boss_sign                           
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime            
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime           
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline                
    ,nd.contact_policy                                         AS  contact_policy                      
    ,nd.is_recovery                                            AS  is_recovery                         
    ,nd.2013_3_sign                                            AS  2013_3_sign                         
    ,nd.source_type                                            AS  source_type                         
    ,nd.organize_id                                            AS  organize_id                         
    ,nd.domainFrom                                             AS  domainFrom                          
    ,nd.is_estate                                              AS  is_estate                           
    ,nd.estate_num                                             AS  estate_num                          
    ,nd.is_estate_project                                      AS  is_estate_project                   
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date         
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount       
    ,nd.is_car                                                 AS  is_car                              
    ,nd.car_num                                                AS  car_num                             
    ,nd.is_car_mortgage                                        AS  is_car_mortgage                     
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date           
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount         
    ,nd.is_car_full                                            AS  is_car_full                         
    ,nd.car_full_amaount                                       AS  car_full_amaount                    
    ,nd.by_car_date                                            AS  by_car_date                         
    ,nd.is_business_entity                                     AS  is_business_entity                  
    ,nd.business_entity_water                                  AS  business_entity_water               
    ,nd.is_business_license                                    AS  is_business_license                 
    ,nd.registration_date                                      AS  registration_date                   
    ,nd.no_business_license_date                               AS  no_business_license_date            
    ,nd.is_credit                                              AS  is_credit                           
    ,nd.credit_total_amount                                    AS  credit_total_amount                 
    ,nd.credit_use_amount                                      AS  credit_use_amount                   
    ,nd.is_social_security                                     AS  is_social_security                  
    ,nd.social_security_base                                   AS  social_security_base                
    ,nd.social_security_hand                                   AS  social_security_hand                
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund                
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base              
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand              
    ,nd.is_policy                                              AS  is_policy                           
    ,nd.year_month_pay                                         AS  year_month_pay                      
    ,nd.policy_type                                            AS  policy_type                         
    ,nd.policy_date                                            AS  policy_date                         
    ,nd.policy_amount                                          AS  policy_amount                       
    ,nd.is_history_project                                     AS  is_history_project                  
    ,nd.history_project                                        AS  history_project                     
    ,nd.is_rejected_project                                    AS  is_rejected_project                 
    ,nd.rejected_project_reason                                AS  rejected_project_reason             
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse              
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague           
    ,nd.is_know_project_relative                               AS  is_know_project_relative            
    ,nd.is_know_project_friend                                 AS  is_know_project_friend              
    ,nd.credit_total_overdue                                   AS  credit_total_overdue                
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue           
    ,nd.income_amount                                          AS  income_amount                       
    ,nd.business_entity                                        AS  business_entity                     
    ,nd.flowing                                                AS  flowing                             
    ,nd.nation                                                 AS  nation                              
    ,nd.education                                              AS  education                           
    ,nd.wedlock                                                AS  wedlock                             
    ,nd.income_source                                          AS  income_source                       
    ,nd.is_children                                            AS  is_children                         
    ,nd.is_verify                                              AS  is_verify                           
    ,nd.verify_user_id                                         AS  verify_user_id                      
    ,nd.verify_date                                            AS  verify_date                         
    ,nd.profession                                             AS  profession                          
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id                
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name              
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id                
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name              
    ,nd.purchase_type                                          AS  purchase_type                       
    ,nd.from_channels1_id                                      AS  from_channels1_id                   
    ,nd.from_channels1_name                                    AS  from_channels1_name                 
    ,nd.from_channels2_id                                      AS  from_channels2_id                   
    ,nd.from_channels2_name                                    AS  from_channels2_name                 
    ,nd.create_type                                            AS  create_type                         
    ,nd.assigned_user_id_bak                                   AS  assigned_user_id_bak                
    ,nd.assigned_dept_id_bak                                   AS  assigned_dept_id_bak                
    ,nd.idcardno_address                                       AS  idcardno_address                    

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_bj
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
LEFT JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）

WHERE
    od.id IS NULL                                              ##--ND有,OD无：即为新增
;

##----[STEP1.4] - CRM_WH库新增数据写入SDA_CRM_ACCOUNTS_H_INS表
INSERT INTO sda_crm_accounts_h_ins
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id                                     
    ,name                                   
    ,date_entered                           
    ,date_modified                          
    ,modified_user_id                       
    ,assigned_user_id                       
    ,created_by                             
    ,description                            
    ,deleted                                
    ,assigned_dept_id                       
    ,readed_sign                            
    ,assigned_user_time                     
    ,first_name                             
    ,last_name                              
    ,gender                                 
    ,company                                
    ,search_code                            
    ,phone_mobile1                          
    ,phone_mobile2                          
    ,phone_home1_code                       
    ,phone_home1                            
    ,phone_home1_no                         
    ,phone_home2_code                       
    ,phone_home2                            
    ,phone_home2_no                         
    ,phone_fax_code                         
    ,phone_fax                              
    ,phone_fax_no                           
    ,qq                                     
    ,mail_address                           
    ,msn                                    
    ,primary_address_street                 
    ,primary_address_city                   
    ,primary_address_zone                   
    ,primary_address_plot                   
    ,alt_address_street                     
    ,alt_address_city                       
    ,alt_address_zone                       
    ,alt_address_plot                       
    ,going                                  
    ,birthdate                              
    ,idcardno                               
    ,credit_status                          
    ,credit_desc                            
    ,flowing_water                          
    ,industry                               
    ,area                                   
    ,registration_time                      
    ,operation_time                         
    ,year_income                            
    ,profit_rate                            
    ,stock_value                            
    ,account_source1                        
    ,account_source2                        
    ,campaign_id                            
    ,parent_type                            
    ,parent_id                              
    ,account_value                          
    ,life_cycle                             
    ,date_cycle_start                       
    ,second_sales_possibility               
    ,maintenance_policy                     
    ,status                                 
    ,recent_stranded_date                   
    ,first_call_datetime                    
    ,first_meeting_datetime                 
    ,last_call_datetime                     
    ,last_meeting_datetime                  
    ,next_call_datetime                     
    ,next_meeting_datetime                  
    ,next_contact_datetime                  
    ,total_call_count                       
    ,total_meeting_count                    
    ,final_contact_datetime                 
    ,info_deadline                          
    ,manager_deadline                       
    ,change_manager_deadline                
    ,dept_deadline                          
    ,lifecycle_deadline                     
    ,accountinfo_completeness_sign          
    ,opptinfo_completeness_sign             
    ,number                                 
    ,property_prove                         
    ,stranded_user_id                       
    ,initial_user_id                        
    ,initial_dept_id                        
    ,change_times                           
    ,main_number_field                      
    ,unicode_id                             
    ,is_private                             
    ,cancel_sign                            
    ,date_created                           
    ,activation_count                       
    ,boss_sign                              
    ,cti_last_callin_datetime               
    ,cti_last_callout_datetime              
    ,cti_contact_deadline                   
    ,contact_policy                         
    ,is_recovery                            
    ,2013_3_sign                            
    ,source_type                            
    ,organize_id                            
    ,domainFrom                             
    ,is_estate                              
    ,estate_num                             
    ,is_estate_project                      
    ,monthly_house_payments_date            
    ,monthly_house_payments_amount          
    ,is_car                                 
    ,car_num                                
    ,is_car_mortgage                        
    ,monthly_car_payments_date              
    ,monthly_car_payments_amount            
    ,is_car_full                            
    ,car_full_amaount                       
    ,by_car_date                            
    ,is_business_entity                     
    ,business_entity_water                  
    ,is_business_license                    
    ,registration_date                      
    ,no_business_license_date               
    ,is_credit                              
    ,credit_total_amount                    
    ,credit_use_amount                      
    ,is_social_security                     
    ,social_security_base                   
    ,social_security_hand                   
    ,is_accumulation_fund                   
    ,accumulation_fund_base                 
    ,accumulation_fund_hand                 
    ,is_policy                              
    ,year_month_pay                         
    ,policy_type                            
    ,policy_date                            
    ,policy_amount                          
    ,is_history_project                     
    ,history_project                        
    ,is_rejected_project                    
    ,rejected_project_reason                
    ,is_know_project_spouse                 
    ,is_know_project_colleague              
    ,is_know_project_relative               
    ,is_know_project_friend                 
    ,credit_total_overdue                   
    ,credit_continuous_overdue              
    ,income_amount                          
    ,business_entity                        
    ,flowing                                
    ,nation                                 
    ,education                              
    ,wedlock                                
    ,income_source                          
    ,is_children                            
    ,is_verify                              
    ,verify_user_id                         
    ,verify_date                            
    ,profession                             
    ,purchase_channel1_id                   
    ,purchase_channel1_name                 
    ,purchase_channel2_id                   
    ,purchase_channel2_name                 
    ,purchase_type                          
    ,from_channels1_id                      
    ,from_channels1_name                    
    ,from_channels2_id                      
    ,from_channels2_name                    
    ,create_type                            
    ,idcardno_address                       
)   
SELECT
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    

    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                           
    ,nd.name                                                   AS  name                         
    ,nd.date_entered                                           AS  date_entered                 
    ,nd.date_modified                                          AS  date_modified                
    ,nd.modified_user_id                                       AS  modified_user_id             
    ,nd.assigned_user_id                                       AS  assigned_user_id             
    ,nd.created_by                                             AS  created_by                   
    ,nd.description                                            AS  description                  
    ,nd.deleted                                                AS  deleted                      
    ,nd.assigned_dept_id                                       AS  assigned_dept_id             
    ,nd.readed_sign                                            AS  readed_sign                  
    ,nd.assigned_user_time                                     AS  assigned_user_time           
    ,nd.first_name                                             AS  first_name                   
    ,nd.last_name                                              AS  last_name                    
    ,nd.gender                                                 AS  gender                       
    ,nd.company                                                AS  company                      
    ,nd.search_code                                            AS  search_code                  
    ,nd.phone_mobile1                                          AS  phone_mobile1                
    ,nd.phone_mobile2                                          AS  phone_mobile2                
    ,nd.phone_home1_code                                       AS  phone_home1_code             
    ,nd.phone_home1                                            AS  phone_home1                  
    ,nd.phone_home1_no                                         AS  phone_home1_no               
    ,nd.phone_home2_code                                       AS  phone_home2_code             
    ,nd.phone_home2                                            AS  phone_home2                  
    ,nd.phone_home2_no                                         AS  phone_home2_no               
    ,nd.phone_fax_code                                         AS  phone_fax_code               
    ,nd.phone_fax                                              AS  phone_fax                    
    ,nd.phone_fax_no                                           AS  phone_fax_no                 
    ,nd.qq                                                     AS  qq                           
    ,nd.mail_address                                           AS  mail_address                 
    ,nd.msn                                                    AS  msn                          
    ,nd.primary_address_street                                 AS  primary_address_street       
    ,nd.primary_address_city                                   AS  primary_address_city         
    ,nd.primary_address_zone                                   AS  primary_address_zone         
    ,nd.primary_address_plot                                   AS  primary_address_plot         
    ,nd.alt_address_street                                     AS  alt_address_street           
    ,nd.alt_address_city                                       AS  alt_address_city             
    ,nd.alt_address_zone                                       AS  alt_address_zone             
    ,nd.alt_address_plot                                       AS  alt_address_plot             
    ,nd.going                                                  AS  going                        
    ,nd.birthdate                                              AS  birthdate                    
    ,nd.idcardno                                               AS  idcardno                     
    ,nd.credit_status                                          AS  credit_status                
    ,nd.credit_desc                                            AS  credit_desc                  
    ,nd.flowing_water                                          AS  flowing_water                
    ,nd.industry                                               AS  industry                     
    ,nd.area                                                   AS  area                         
    ,nd.registration_time                                      AS  registration_time            
    ,nd.operation_time                                         AS  operation_time               
    ,nd.year_income                                            AS  year_income                  
    ,nd.profit_rate                                            AS  profit_rate                  
    ,nd.stock_value                                            AS  stock_value                  
    ,nd.account_source1                                        AS  account_source1              
    ,nd.account_source2                                        AS  account_source2              
    ,nd.campaign_id                                            AS  campaign_id                  
    ,nd.parent_type                                            AS  parent_type                  
    ,nd.parent_id                                              AS  parent_id                    
    ,nd.account_value                                          AS  account_value                
    ,nd.life_cycle                                             AS  life_cycle                   
    ,nd.date_cycle_start                                       AS  date_cycle_start             
    ,nd.second_sales_possibility                               AS  second_sales_possibility     
    ,nd.maintenance_policy                                     AS  maintenance_policy           
    ,nd.status                                                 AS  status                       
    ,nd.recent_stranded_date                                   AS  recent_stranded_date         
    ,nd.first_call_datetime                                    AS  first_call_datetime          
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime       
    ,nd.last_call_datetime                                     AS  last_call_datetime           
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime        
    ,nd.next_call_datetime                                     AS  next_call_datetime           
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime        
    ,nd.next_contact_datetime                                  AS  next_contact_datetime        
    ,nd.total_call_count                                       AS  total_call_count             
    ,nd.total_meeting_count                                    AS  total_meeting_count          
    ,nd.final_contact_datetime                                 AS  final_contact_datetime       
    ,nd.info_deadline                                          AS  info_deadline                
    ,nd.manager_deadline                                       AS  manager_deadline             
    ,nd.change_manager_deadline                                AS  change_manager_deadline      
    ,nd.dept_deadline                                          AS  dept_deadline                
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline           
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign   
    ,nd.number                                                 AS  number                       
    ,nd.property_prove                                         AS  property_prove               
    ,nd.stranded_user_id                                       AS  stranded_user_id             
    ,nd.initial_user_id                                        AS  initial_user_id              
    ,nd.initial_dept_id                                        AS  initial_dept_id              
    ,nd.change_times                                           AS  change_times                 
    ,nd.main_number_field                                      AS  main_number_field            
    ,nd.unicode_id                                             AS  unicode_id                   
    ,nd.is_private                                             AS  is_private                   
    ,nd.cancel_sign                                            AS  cancel_sign                  
    ,nd.date_created                                           AS  date_created                 
    ,nd.activation_count                                       AS  activation_count             
    ,nd.boss_sign                                              AS  boss_sign                    
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime     
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime    
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline         
    ,nd.contact_policy                                         AS  contact_policy               
    ,nd.is_recovery                                            AS  is_recovery                  
    ,nd.2013_3_sign                                            AS  2013_3_sign                  
    ,nd.source_type                                            AS  source_type                  
    ,nd.organize_id                                            AS  organize_id                  
    ,nd.domainFrom                                             AS  domainFrom                   
    ,nd.is_estate                                              AS  is_estate                    
    ,nd.estate_num                                             AS  estate_num                   
    ,nd.is_estate_project                                      AS  is_estate_project            
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date  
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount
    ,nd.is_car                                                 AS  is_car                       
    ,nd.car_num                                                AS  car_num                      
    ,nd.is_car_mortgage                                        AS  is_car_mortgage              
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date    
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount  
    ,nd.is_car_full                                            AS  is_car_full                  
    ,nd.car_full_amaount                                       AS  car_full_amaount             
    ,nd.by_car_date                                            AS  by_car_date                  
    ,nd.is_business_entity                                     AS  is_business_entity           
    ,nd.business_entity_water                                  AS  business_entity_water        
    ,nd.is_business_license                                    AS  is_business_license          
    ,nd.registration_date                                      AS  registration_date            
    ,nd.no_business_license_date                               AS  no_business_license_date     
    ,nd.is_credit                                              AS  is_credit                    
    ,nd.credit_total_amount                                    AS  credit_total_amount          
    ,nd.credit_use_amount                                      AS  credit_use_amount            
    ,nd.is_social_security                                     AS  is_social_security           
    ,nd.social_security_base                                   AS  social_security_base         
    ,nd.social_security_hand                                   AS  social_security_hand         
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund         
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base       
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand       
    ,nd.is_policy                                              AS  is_policy                    
    ,nd.year_month_pay                                         AS  year_month_pay               
    ,nd.policy_type                                            AS  policy_type                  
    ,nd.policy_date                                            AS  policy_date                  
    ,nd.policy_amount                                          AS  policy_amount                
    ,nd.is_history_project                                     AS  is_history_project           
    ,nd.history_project                                        AS  history_project              
    ,nd.is_rejected_project                                    AS  is_rejected_project          
    ,nd.rejected_project_reason                                AS  rejected_project_reason      
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse       
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague    
    ,nd.is_know_project_relative                               AS  is_know_project_relative     
    ,nd.is_know_project_friend                                 AS  is_know_project_friend       
    ,nd.credit_total_overdue                                   AS  credit_total_overdue         
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue    
    ,nd.income_amount                                          AS  income_amount                
    ,nd.business_entity                                        AS  business_entity              
    ,nd.flowing                                                AS  flowing                      
    ,nd.nation                                                 AS  nation                       
    ,nd.education                                              AS  education                    
    ,nd.wedlock                                                AS  wedlock                      
    ,nd.income_source                                          AS  income_source                
    ,nd.is_children                                            AS  is_children                  
    ,nd.is_verify                                              AS  is_verify                    
    ,nd.verify_user_id                                         AS  verify_user_id               
    ,nd.verify_date                                            AS  verify_date                  
    ,nd.profession                                             AS  profession                   
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id         
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name       
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id         
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name       
    ,nd.purchase_type                                          AS  purchase_type                
    ,nd.from_channels1_id                                      AS  from_channels1_id            
    ,nd.from_channels1_name                                    AS  from_channels1_name          
    ,nd.from_channels2_id                                      AS  from_channels2_id            
    ,nd.from_channels2_name                                    AS  from_channels2_name          
    ,nd.create_type                                            AS  create_type                  
    ,nd.idcardno_address                                       AS  idcardno_address             

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_wh
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
LEFT JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）

WHERE
    od.id IS NULL                                              ##--ND有,OD无：即为新增
;
</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename />
      <sendOneStatement>F</sendOneStatement>
      <connection>conn_edw</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>224</xloc>
      <yloc>144</yloc>
    </entry>
    <entry>
      <name>[STEP2]:识别当日修改数据</name>
      <description />
      <type>SQL</type>
      <sql>##--[STEP2]:识别当日修改数据 - 创建临时表SDA_CRM_ACCOUNTS_H_UPD，存储当日修改数据

##----[STEP2.1] - 创建临时表SDA_CRM_ACCOUNTS_H_UPD
DROP TABLE IF EXISTS sda_crm_accounts_h_upd;
CREATE TABLE sda_crm_accounts_h_upd LIKE sda_crm_accounts_h;

##----[STEP2.2] - CRM_CD库修改数据写入SDA_CRM_ACCOUNTS_H_UPD表
INSERT INTO sda_crm_accounts_h_upd
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,idcardno_address
)
SELECT 
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    
    
    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                                
    ,nd.name                                                   AS  name                              
    ,nd.date_entered                                           AS  date_entered                      
    ,nd.date_modified                                          AS  date_modified                     
    ,nd.modified_user_id                                       AS  modified_user_id                  
    ,nd.assigned_user_id                                       AS  assigned_user_id                  
    ,nd.created_by                                             AS  created_by                        
    ,nd.description                                            AS  description                       
    ,nd.deleted                                                AS  deleted                           
    ,nd.assigned_dept_id                                       AS  assigned_dept_id                  
    ,nd.readed_sign                                            AS  readed_sign                       
    ,nd.assigned_user_time                                     AS  assigned_user_time                
    ,nd.first_name                                             AS  first_name                        
    ,nd.last_name                                              AS  last_name                         
    ,nd.gender                                                 AS  gender                            
    ,nd.company                                                AS  company                           
    ,nd.search_code                                            AS  search_code                       
    ,nd.phone_mobile1                                          AS  phone_mobile1                     
    ,nd.phone_mobile2                                          AS  phone_mobile2                     
    ,nd.phone_home1_code                                       AS  phone_home1_code                  
    ,nd.phone_home1                                            AS  phone_home1                       
    ,nd.phone_home1_no                                         AS  phone_home1_no                    
    ,nd.phone_home2_code                                       AS  phone_home2_code                  
    ,nd.phone_home2                                            AS  phone_home2                       
    ,nd.phone_home2_no                                         AS  phone_home2_no                    
    ,nd.phone_fax_code                                         AS  phone_fax_code                    
    ,nd.phone_fax                                              AS  phone_fax                         
    ,nd.phone_fax_no                                           AS  phone_fax_no                      
    ,nd.qq                                                     AS  qq                                
    ,nd.mail_address                                           AS  mail_address                      
    ,nd.msn                                                    AS  msn                               
    ,nd.primary_address_street                                 AS  primary_address_street            
    ,nd.primary_address_city                                   AS  primary_address_city              
    ,nd.primary_address_zone                                   AS  primary_address_zone              
    ,nd.primary_address_plot                                   AS  primary_address_plot              
    ,nd.alt_address_street                                     AS  alt_address_street                
    ,nd.alt_address_city                                       AS  alt_address_city                  
    ,nd.alt_address_zone                                       AS  alt_address_zone                  
    ,nd.alt_address_plot                                       AS  alt_address_plot                  
    ,nd.going                                                  AS  going                             
    ,nd.birthdate                                              AS  birthdate                         
    ,nd.idcardno                                               AS  idcardno                          
    ,nd.credit_status                                          AS  credit_status                     
    ,nd.credit_desc                                            AS  credit_desc                       
    ,nd.flowing_water                                          AS  flowing_water                     
    ,nd.industry                                               AS  industry                          
    ,nd.area                                                   AS  area                              
    ,nd.registration_time                                      AS  registration_time                 
    ,nd.operation_time                                         AS  operation_time                    
    ,nd.year_income                                            AS  year_income                       
    ,nd.profit_rate                                            AS  profit_rate                       
    ,nd.stock_value                                            AS  stock_value                       
    ,nd.account_source1                                        AS  account_source1                   
    ,nd.account_source2                                        AS  account_source2                   
    ,nd.campaign_id                                            AS  campaign_id                       
    ,nd.parent_type                                            AS  parent_type                       
    ,nd.parent_id                                              AS  parent_id                         
    ,nd.account_value                                          AS  account_value                     
    ,nd.life_cycle                                             AS  life_cycle                        
    ,nd.date_cycle_start                                       AS  date_cycle_start                  
    ,nd.second_sales_possibility                               AS  second_sales_possibility          
    ,nd.maintenance_policy                                     AS  maintenance_policy                
    ,nd.status                                                 AS  status                            
    ,nd.recent_stranded_date                                   AS  recent_stranded_date              
    ,nd.first_call_datetime                                    AS  first_call_datetime               
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime            
    ,nd.last_call_datetime                                     AS  last_call_datetime                
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime             
    ,nd.next_call_datetime                                     AS  next_call_datetime                
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime             
    ,nd.next_contact_datetime                                  AS  next_contact_datetime             
    ,nd.total_call_count                                       AS  total_call_count                  
    ,nd.total_meeting_count                                    AS  total_meeting_count               
    ,nd.final_contact_datetime                                 AS  final_contact_datetime            
    ,nd.info_deadline                                          AS  info_deadline                     
    ,nd.manager_deadline                                       AS  manager_deadline                  
    ,nd.change_manager_deadline                                AS  change_manager_deadline           
    ,nd.dept_deadline                                          AS  dept_deadline                     
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline                
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign     
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign        
    ,nd.number                                                 AS  number                            
    ,nd.property_prove                                         AS  property_prove                    
    ,nd.stranded_user_id                                       AS  stranded_user_id                  
    ,nd.initial_user_id                                        AS  initial_user_id                   
    ,nd.initial_dept_id                                        AS  initial_dept_id                   
    ,nd.change_times                                           AS  change_times                      
    ,nd.main_number_field                                      AS  main_number_field                 
    ,nd.unicode_id                                             AS  unicode_id                        
    ,nd.is_private                                             AS  is_private                        
    ,nd.cancel_sign                                            AS  cancel_sign                       
    ,nd.date_created                                           AS  date_created                      
    ,nd.activation_count                                       AS  activation_count                  
    ,nd.boss_sign                                              AS  boss_sign                         
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime          
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime         
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline              
    ,nd.contact_policy                                         AS  contact_policy                    
    ,nd.is_recovery                                            AS  is_recovery                       
    ,nd.2013_3_sign                                            AS  2013_3_sign                       
    ,nd.source_type                                            AS  source_type                       
    ,nd.organize_id                                            AS  organize_id                       
    ,nd.domainFrom                                             AS  domainFrom                        
    ,nd.is_estate                                              AS  is_estate                         
    ,nd.estate_num                                             AS  estate_num                        
    ,nd.is_estate_project                                      AS  is_estate_project                 
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date       
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount     
    ,nd.is_car                                                 AS  is_car                            
    ,nd.car_num                                                AS  car_num                           
    ,nd.is_car_mortgage                                        AS  is_car_mortgage                   
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date         
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount       
    ,nd.is_car_full                                            AS  is_car_full                       
    ,nd.car_full_amaount                                       AS  car_full_amaount                  
    ,nd.by_car_date                                            AS  by_car_date                       
    ,nd.is_business_entity                                     AS  is_business_entity                
    ,nd.business_entity_water                                  AS  business_entity_water             
    ,nd.is_business_license                                    AS  is_business_license               
    ,nd.registration_date                                      AS  registration_date                 
    ,nd.no_business_license_date                               AS  no_business_license_date          
    ,nd.is_credit                                              AS  is_credit                         
    ,nd.credit_total_amount                                    AS  credit_total_amount               
    ,nd.credit_use_amount                                      AS  credit_use_amount                 
    ,nd.is_social_security                                     AS  is_social_security                
    ,nd.social_security_base                                   AS  social_security_base              
    ,nd.social_security_hand                                   AS  social_security_hand              
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund              
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base            
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand            
    ,nd.is_policy                                              AS  is_policy                         
    ,nd.year_month_pay                                         AS  year_month_pay                    
    ,nd.policy_type                                            AS  policy_type                       
    ,nd.policy_date                                            AS  policy_date                       
    ,nd.policy_amount                                          AS  policy_amount                     
    ,nd.is_history_project                                     AS  is_history_project                
    ,nd.history_project                                        AS  history_project                   
    ,nd.is_rejected_project                                    AS  is_rejected_project               
    ,nd.rejected_project_reason                                AS  rejected_project_reason           
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse            
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague         
    ,nd.is_know_project_relative                               AS  is_know_project_relative          
    ,nd.is_know_project_friend                                 AS  is_know_project_friend            
    ,nd.credit_total_overdue                                   AS  credit_total_overdue              
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue         
    ,nd.income_amount                                          AS  income_amount                     
    ,nd.business_entity                                        AS  business_entity                   
    ,nd.flowing                                                AS  flowing                           
    ,nd.nation                                                 AS  nation                            
    ,nd.education                                              AS  education                         
    ,nd.wedlock                                                AS  wedlock                           
    ,nd.income_source                                          AS  income_source                     
    ,nd.is_children                                            AS  is_children                       
    ,nd.is_verify                                              AS  is_verify                         
    ,nd.verify_user_id                                         AS  verify_user_id                    
    ,nd.verify_date                                            AS  verify_date                       
    ,nd.profession                                             AS  profession                        
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id              
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name            
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id              
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name            
    ,nd.purchase_type                                          AS  purchase_type                     
    ,nd.from_channels1_id                                      AS  from_channels1_id                 
    ,nd.from_channels1_name                                    AS  from_channels1_name               
    ,nd.from_channels2_id                                      AS  from_channels2_id                 
    ,nd.from_channels2_name                                    AS  from_channels2_name               
    ,nd.create_type                                            AS  create_type                       
    ,nd.idcardno_address                                       AS  idcardno_address                  

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_cd
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
INNER JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    ##--修改数据:ND表和OD表主键一致，除主键字段外，其他任一字段不一致
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）
AND CONCAT_WS(
               '|@|'
              ,nd.name                              
              ,nd.date_entered                      
              ,nd.date_modified                     
              ,nd.modified_user_id                  
              ,nd.assigned_user_id                  
              ,nd.created_by                        
              ,nd.description                       
              ,nd.deleted                           
              ,nd.assigned_dept_id                  
              ,nd.readed_sign                       
              ,nd.assigned_user_time                
              ,nd.first_name                        
              ,nd.last_name                         
              ,nd.gender                            
              ,nd.company                           
              ,nd.search_code                       
              ,nd.phone_mobile1                     
              ,nd.phone_mobile2                     
              ,nd.phone_home1_code                  
              ,nd.phone_home1                       
              ,nd.phone_home1_no                    
              ,nd.phone_home2_code                  
              ,nd.phone_home2                       
              ,nd.phone_home2_no                    
              ,nd.phone_fax_code                    
              ,nd.phone_fax                         
              ,nd.phone_fax_no                      
              ,nd.qq                                
              ,nd.mail_address                      
              ,nd.msn                               
              ,nd.primary_address_street            
              ,nd.primary_address_city              
              ,nd.primary_address_zone              
              ,nd.primary_address_plot              
              ,nd.alt_address_street                
              ,nd.alt_address_city                  
              ,nd.alt_address_zone                  
              ,nd.alt_address_plot                  
              ,nd.going                             
              ,nd.birthdate                         
              ,nd.idcardno                          
              ,nd.credit_status                     
              ,nd.credit_desc                       
              ,nd.flowing_water                     
              ,nd.industry                          
              ,nd.area                              
              ,nd.registration_time                 
              ,nd.operation_time                    
              ,nd.year_income                       
              ,nd.profit_rate                       
              ,nd.stock_value                       
              ,nd.account_source1                   
              ,nd.account_source2                   
              ,nd.campaign_id                       
              ,nd.parent_type                       
              ,nd.parent_id                         
              ,nd.account_value                     
              ,nd.life_cycle                        
              ,nd.date_cycle_start                  
              ,nd.second_sales_possibility          
              ,nd.maintenance_policy                
              ,nd.status                            
              ,nd.recent_stranded_date              
              ,nd.first_call_datetime               
              ,nd.first_meeting_datetime            
              ,nd.last_call_datetime                
              ,nd.last_meeting_datetime             
              ,nd.next_call_datetime                
              ,nd.next_meeting_datetime             
              ,nd.next_contact_datetime             
              ,nd.total_call_count                  
              ,nd.total_meeting_count               
              ,nd.final_contact_datetime            
              ,nd.info_deadline                     
              ,nd.manager_deadline                  
              ,nd.change_manager_deadline           
              ,nd.dept_deadline                     
              ,nd.lifecycle_deadline                
              ,nd.accountinfo_completeness_sign     
              ,nd.opptinfo_completeness_sign        
              ,nd.number                            
              ,nd.property_prove                    
              ,nd.stranded_user_id                  
              ,nd.initial_user_id                   
              ,nd.initial_dept_id                   
              ,nd.change_times                      
              ,nd.main_number_field                 
              ,nd.unicode_id                        
              ,nd.is_private                        
              ,nd.cancel_sign                       
              ,nd.date_created                      
              ,nd.activation_count                  
              ,nd.boss_sign                         
              ,nd.cti_last_callin_datetime          
              ,nd.cti_last_callout_datetime         
              ,nd.cti_contact_deadline              
              ,nd.contact_policy                    
              ,nd.is_recovery                       
              ,nd.2013_3_sign                       
              ,nd.source_type                       
              ,nd.organize_id                       
              ,nd.domainFrom                        
              ,nd.is_estate                         
              ,nd.estate_num                        
              ,nd.is_estate_project                 
              ,nd.monthly_house_payments_date       
              ,nd.monthly_house_payments_amount     
              ,nd.is_car                            
              ,nd.car_num                           
              ,nd.is_car_mortgage                   
              ,nd.monthly_car_payments_date         
              ,nd.monthly_car_payments_amount       
              ,nd.is_car_full                       
              ,nd.car_full_amaount                  
              ,nd.by_car_date                       
              ,nd.is_business_entity                
              ,nd.business_entity_water             
              ,nd.is_business_license               
              ,nd.registration_date                 
              ,nd.no_business_license_date          
              ,nd.is_credit                         
              ,nd.credit_total_amount               
              ,nd.credit_use_amount                 
              ,nd.is_social_security                
              ,nd.social_security_base              
              ,nd.social_security_hand              
              ,nd.is_accumulation_fund              
              ,nd.accumulation_fund_base            
              ,nd.accumulation_fund_hand            
              ,nd.is_policy                         
              ,nd.year_month_pay                    
              ,nd.policy_type                       
              ,nd.policy_date                       
              ,nd.policy_amount                     
              ,nd.is_history_project                
              ,nd.history_project                   
              ,nd.is_rejected_project               
              ,nd.rejected_project_reason           
              ,nd.is_know_project_spouse            
              ,nd.is_know_project_colleague         
              ,nd.is_know_project_relative          
              ,nd.is_know_project_friend            
              ,nd.credit_total_overdue              
              ,nd.credit_continuous_overdue         
              ,nd.income_amount                     
              ,nd.business_entity                   
              ,nd.flowing                           
              ,nd.nation                            
              ,nd.education                         
              ,nd.wedlock                           
              ,nd.income_source                     
              ,nd.is_children                       
              ,nd.is_verify                         
              ,nd.verify_user_id                    
              ,nd.verify_date                       
              ,nd.profession                        
              ,nd.purchase_channel1_id              
              ,nd.purchase_channel1_name            
              ,nd.purchase_channel2_id              
              ,nd.purchase_channel2_name            
              ,nd.purchase_type                     
              ,nd.from_channels1_id                 
              ,nd.from_channels1_name               
              ,nd.from_channels2_id                 
              ,nd.from_channels2_name               
              ,nd.create_type                       
              ,nd.idcardno_address 
             ) 
 &lt;&gt; CONCAT_WS(
               '|@|'
              ,od.name                              
              ,od.date_entered                      
              ,od.date_modified                     
              ,od.modified_user_id                  
              ,od.assigned_user_id                  
              ,od.created_by                        
              ,od.description                       
              ,od.deleted                           
              ,od.assigned_dept_id                  
              ,od.readed_sign                       
              ,od.assigned_user_time                
              ,od.first_name                        
              ,od.last_name                         
              ,od.gender                            
              ,od.company                           
              ,od.search_code                       
              ,od.phone_mobile1                     
              ,od.phone_mobile2                     
              ,od.phone_home1_code                  
              ,od.phone_home1                       
              ,od.phone_home1_no                    
              ,od.phone_home2_code                  
              ,od.phone_home2                       
              ,od.phone_home2_no                    
              ,od.phone_fax_code                    
              ,od.phone_fax                         
              ,od.phone_fax_no                      
              ,od.qq                                
              ,od.mail_address                      
              ,od.msn                               
              ,od.primary_address_street            
              ,od.primary_address_city              
              ,od.primary_address_zone              
              ,od.primary_address_plot              
              ,od.alt_address_street                
              ,od.alt_address_city                  
              ,od.alt_address_zone                  
              ,od.alt_address_plot                  
              ,od.going                             
              ,od.birthdate                         
              ,od.idcardno                          
              ,od.credit_status                     
              ,od.credit_desc                       
              ,od.flowing_water                     
              ,od.industry                          
              ,od.area                              
              ,od.registration_time                 
              ,od.operation_time                    
              ,od.year_income                       
              ,od.profit_rate                       
              ,od.stock_value                       
              ,od.account_source1                   
              ,od.account_source2                   
              ,od.campaign_id                       
              ,od.parent_type                       
              ,od.parent_id                         
              ,od.account_value                     
              ,od.life_cycle                        
              ,od.date_cycle_start                  
              ,od.second_sales_possibility          
              ,od.maintenance_policy                
              ,od.status                            
              ,od.recent_stranded_date              
              ,od.first_call_datetime               
              ,od.first_meeting_datetime            
              ,od.last_call_datetime                
              ,od.last_meeting_datetime             
              ,od.next_call_datetime                
              ,od.next_meeting_datetime             
              ,od.next_contact_datetime             
              ,od.total_call_count                  
              ,od.total_meeting_count               
              ,od.final_contact_datetime            
              ,od.info_deadline                     
              ,od.manager_deadline                  
              ,od.change_manager_deadline           
              ,od.dept_deadline                     
              ,od.lifecycle_deadline                
              ,od.accountinfo_completeness_sign     
              ,od.opptinfo_completeness_sign        
              ,od.number                            
              ,od.property_prove                    
              ,od.stranded_user_id                  
              ,od.initial_user_id                   
              ,od.initial_dept_id                   
              ,od.change_times                      
              ,od.main_number_field                 
              ,od.unicode_id                        
              ,od.is_private                        
              ,od.cancel_sign                       
              ,od.date_created                      
              ,od.activation_count                  
              ,od.boss_sign                         
              ,od.cti_last_callin_datetime          
              ,od.cti_last_callout_datetime         
              ,od.cti_contact_deadline              
              ,od.contact_policy                    
              ,od.is_recovery                       
              ,od.2013_3_sign                       
              ,od.source_type                       
              ,od.organize_id                       
              ,od.domainFrom                        
              ,od.is_estate                         
              ,od.estate_num                        
              ,od.is_estate_project                 
              ,od.monthly_house_payments_date       
              ,od.monthly_house_payments_amount     
              ,od.is_car                            
              ,od.car_num                           
              ,od.is_car_mortgage                   
              ,od.monthly_car_payments_date         
              ,od.monthly_car_payments_amount       
              ,od.is_car_full                       
              ,od.car_full_amaount                  
              ,od.by_car_date                       
              ,od.is_business_entity                
              ,od.business_entity_water             
              ,od.is_business_license               
              ,od.registration_date                 
              ,od.no_business_license_date          
              ,od.is_credit                         
              ,od.credit_total_amount               
              ,od.credit_use_amount                 
              ,od.is_social_security                
              ,od.social_security_base              
              ,od.social_security_hand              
              ,od.is_accumulation_fund              
              ,od.accumulation_fund_base            
              ,od.accumulation_fund_hand            
              ,od.is_policy                         
              ,od.year_month_pay                    
              ,od.policy_type                       
              ,od.policy_date                       
              ,od.policy_amount                     
              ,od.is_history_project                
              ,od.history_project                   
              ,od.is_rejected_project               
              ,od.rejected_project_reason           
              ,od.is_know_project_spouse            
              ,od.is_know_project_colleague         
              ,od.is_know_project_relative          
              ,od.is_know_project_friend            
              ,od.credit_total_overdue              
              ,od.credit_continuous_overdue         
              ,od.income_amount                     
              ,od.business_entity                   
              ,od.flowing                           
              ,od.nation                            
              ,od.education                         
              ,od.wedlock                           
              ,od.income_source                     
              ,od.is_children                       
              ,od.is_verify                         
              ,od.verify_user_id                    
              ,od.verify_date                       
              ,od.profession                        
              ,od.purchase_channel1_id              
              ,od.purchase_channel1_name            
              ,od.purchase_channel2_id              
              ,od.purchase_channel2_name            
              ,od.purchase_type                     
              ,od.from_channels1_id                 
              ,od.from_channels1_name               
              ,od.from_channels2_id                 
              ,od.from_channels2_name               
              ,od.create_type                       
              ,od.idcardno_address 
             )
;

##----[STEP2.3] - CRM_BJ库修改数据写入SDA_CRM_ACCOUNTS_H_UPD表
INSERT INTO sda_crm_accounts_h_upd
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id                               
    ,name                             
    ,date_entered                     
    ,date_modified                    
    ,modified_user_id                 
    ,assigned_user_id                 
    ,created_by                       
    ,description                      
    ,deleted                          
    ,assigned_dept_id                 
    ,readed_sign                      
    ,assigned_user_time               
    ,first_name                       
    ,last_name                        
    ,gender                           
    ,company                          
    ,search_code                      
    ,phone_mobile1                    
    ,phone_mobile2                    
    ,phone_home1_code                 
    ,phone_home1                      
    ,phone_home1_no                   
    ,phone_home2_code                 
    ,phone_home2                      
    ,phone_home2_no                   
    ,phone_fax_code                   
    ,phone_fax                        
    ,phone_fax_no                     
    ,qq                               
    ,mail_address                     
    ,msn                              
    ,primary_address_street           
    ,primary_address_city             
    ,primary_address_zone             
    ,primary_address_plot             
    ,alt_address_street               
    ,alt_address_city                 
    ,alt_address_zone                 
    ,alt_address_plot                 
    ,going                            
    ,birthdate                        
    ,idcardno                         
    ,credit_status                    
    ,credit_desc                      
    ,flowing_water                    
    ,industry                         
    ,area                             
    ,registration_time                
    ,operation_time                   
    ,year_income                      
    ,profit_rate                      
    ,stock_value                      
    ,account_source1                  
    ,account_source2                  
    ,campaign_id                      
    ,parent_type                      
    ,parent_id                        
    ,account_value                    
    ,life_cycle                       
    ,date_cycle_start                 
    ,second_sales_possibility         
    ,maintenance_policy               
    ,status                           
    ,recent_stranded_date             
    ,first_call_datetime              
    ,first_meeting_datetime           
    ,last_call_datetime               
    ,last_meeting_datetime            
    ,next_call_datetime               
    ,next_meeting_datetime            
    ,next_contact_datetime            
    ,total_call_count                 
    ,total_meeting_count              
    ,final_contact_datetime           
    ,info_deadline                    
    ,manager_deadline                 
    ,change_manager_deadline          
    ,dept_deadline                    
    ,lifecycle_deadline               
    ,accountinfo_completeness_sign    
    ,opptinfo_completeness_sign       
    ,number                           
    ,property_prove                   
    ,stranded_user_id                 
    ,initial_user_id                  
    ,initial_dept_id                  
    ,change_times                     
    ,main_number_field                
    ,unicode_id                       
    ,is_private                       
    ,cancel_sign                      
    ,date_created                     
    ,activation_count                 
    ,boss_sign                        
    ,cti_last_callin_datetime         
    ,cti_last_callout_datetime        
    ,cti_contact_deadline             
    ,contact_policy                   
    ,is_recovery                      
    ,2013_3_sign                      
    ,source_type                      
    ,organize_id                      
    ,domainFrom                       
    ,is_estate                        
    ,estate_num                       
    ,is_estate_project                
    ,monthly_house_payments_date      
    ,monthly_house_payments_amount    
    ,is_car                           
    ,car_num                          
    ,is_car_mortgage                  
    ,monthly_car_payments_date        
    ,monthly_car_payments_amount      
    ,is_car_full                      
    ,car_full_amaount                 
    ,by_car_date                      
    ,is_business_entity               
    ,business_entity_water            
    ,is_business_license              
    ,registration_date                
    ,no_business_license_date         
    ,is_credit                        
    ,credit_total_amount              
    ,credit_use_amount                
    ,is_social_security               
    ,social_security_base             
    ,social_security_hand             
    ,is_accumulation_fund             
    ,accumulation_fund_base           
    ,accumulation_fund_hand           
    ,is_policy                        
    ,year_month_pay                   
    ,policy_type                      
    ,policy_date                      
    ,policy_amount                    
    ,is_history_project               
    ,history_project                  
    ,is_rejected_project              
    ,rejected_project_reason          
    ,is_know_project_spouse           
    ,is_know_project_colleague        
    ,is_know_project_relative         
    ,is_know_project_friend           
    ,credit_total_overdue             
    ,credit_continuous_overdue        
    ,income_amount                    
    ,business_entity                  
    ,flowing                          
    ,nation                           
    ,education                        
    ,wedlock                          
    ,income_source                    
    ,is_children                      
    ,is_verify                        
    ,verify_user_id                   
    ,verify_date                      
    ,profession                       
    ,purchase_channel1_id             
    ,purchase_channel1_name           
    ,purchase_channel2_id             
    ,purchase_channel2_name           
    ,purchase_type                    
    ,from_channels1_id                
    ,from_channels1_name              
    ,from_channels2_id                
    ,from_channels2_name              
    ,create_type                      
    ,assigned_user_id_bak             
    ,assigned_dept_id_bak             
    ,idcardno_address                 
  
)
SELECT 
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    
    
    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                                                
    ,nd.name                                                   AS  name                                
    ,nd.date_entered                                           AS  date_entered                        
    ,nd.date_modified                                          AS  date_modified                       
    ,nd.modified_user_id                                       AS  modified_user_id                    
    ,nd.assigned_user_id                                       AS  assigned_user_id                    
    ,nd.created_by                                             AS  created_by                          
    ,nd.description                                            AS  description                         
    ,nd.deleted                                                AS  deleted                             
    ,nd.assigned_dept_id                                       AS  assigned_dept_id                    
    ,nd.readed_sign                                            AS  readed_sign                         
    ,nd.assigned_user_time                                     AS  assigned_user_time                  
    ,nd.first_name                                             AS  first_name                          
    ,nd.last_name                                              AS  last_name                           
    ,nd.gender                                                 AS  gender                              
    ,nd.company                                                AS  company                             
    ,nd.search_code                                            AS  search_code                         
    ,nd.phone_mobile1                                          AS  phone_mobile1                       
    ,nd.phone_mobile2                                          AS  phone_mobile2                       
    ,nd.phone_home1_code                                       AS  phone_home1_code                    
    ,nd.phone_home1                                            AS  phone_home1                         
    ,nd.phone_home1_no                                         AS  phone_home1_no                      
    ,nd.phone_home2_code                                       AS  phone_home2_code                    
    ,nd.phone_home2                                            AS  phone_home2                         
    ,nd.phone_home2_no                                         AS  phone_home2_no                      
    ,nd.phone_fax_code                                         AS  phone_fax_code                      
    ,nd.phone_fax                                              AS  phone_fax                           
    ,nd.phone_fax_no                                           AS  phone_fax_no                        
    ,nd.qq                                                     AS  qq                                  
    ,nd.mail_address                                           AS  mail_address                        
    ,nd.msn                                                    AS  msn                                 
    ,nd.primary_address_street                                 AS  primary_address_street              
    ,nd.primary_address_city                                   AS  primary_address_city                
    ,nd.primary_address_zone                                   AS  primary_address_zone                
    ,nd.primary_address_plot                                   AS  primary_address_plot                
    ,nd.alt_address_street                                     AS  alt_address_street                  
    ,nd.alt_address_city                                       AS  alt_address_city                    
    ,nd.alt_address_zone                                       AS  alt_address_zone                    
    ,nd.alt_address_plot                                       AS  alt_address_plot                    
    ,nd.going                                                  AS  going                               
    ,nd.birthdate                                              AS  birthdate                           
    ,nd.idcardno                                               AS  idcardno                            
    ,nd.credit_status                                          AS  credit_status                       
    ,nd.credit_desc                                            AS  credit_desc                         
    ,nd.flowing_water                                          AS  flowing_water                       
    ,nd.industry                                               AS  industry                            
    ,nd.area                                                   AS  area                                
    ,nd.registration_time                                      AS  registration_time                   
    ,nd.operation_time                                         AS  operation_time                      
    ,nd.year_income                                            AS  year_income                         
    ,nd.profit_rate                                            AS  profit_rate                         
    ,nd.stock_value                                            AS  stock_value                         
    ,nd.account_source1                                        AS  account_source1                     
    ,nd.account_source2                                        AS  account_source2                     
    ,nd.campaign_id                                            AS  campaign_id                         
    ,nd.parent_type                                            AS  parent_type                         
    ,nd.parent_id                                              AS  parent_id                           
    ,nd.account_value                                          AS  account_value                       
    ,nd.life_cycle                                             AS  life_cycle                          
    ,nd.date_cycle_start                                       AS  date_cycle_start                    
    ,nd.second_sales_possibility                               AS  second_sales_possibility            
    ,nd.maintenance_policy                                     AS  maintenance_policy                  
    ,nd.status                                                 AS  status                              
    ,nd.recent_stranded_date                                   AS  recent_stranded_date                
    ,nd.first_call_datetime                                    AS  first_call_datetime                 
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime              
    ,nd.last_call_datetime                                     AS  last_call_datetime                  
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime               
    ,nd.next_call_datetime                                     AS  next_call_datetime                  
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime               
    ,nd.next_contact_datetime                                  AS  next_contact_datetime               
    ,nd.total_call_count                                       AS  total_call_count                    
    ,nd.total_meeting_count                                    AS  total_meeting_count                 
    ,nd.final_contact_datetime                                 AS  final_contact_datetime              
    ,nd.info_deadline                                          AS  info_deadline                       
    ,nd.manager_deadline                                       AS  manager_deadline                    
    ,nd.change_manager_deadline                                AS  change_manager_deadline             
    ,nd.dept_deadline                                          AS  dept_deadline                       
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline                  
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign       
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign          
    ,nd.number                                                 AS  number                              
    ,nd.property_prove                                         AS  property_prove                      
    ,nd.stranded_user_id                                       AS  stranded_user_id                    
    ,nd.initial_user_id                                        AS  initial_user_id                     
    ,nd.initial_dept_id                                        AS  initial_dept_id                     
    ,nd.change_times                                           AS  change_times                        
    ,nd.main_number_field                                      AS  main_number_field                   
    ,nd.unicode_id                                             AS  unicode_id                          
    ,nd.is_private                                             AS  is_private                          
    ,nd.cancel_sign                                            AS  cancel_sign                         
    ,nd.date_created                                           AS  date_created                        
    ,nd.activation_count                                       AS  activation_count                    
    ,nd.boss_sign                                              AS  boss_sign                           
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime            
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime           
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline                
    ,nd.contact_policy                                         AS  contact_policy                      
    ,nd.is_recovery                                            AS  is_recovery                         
    ,nd.2013_3_sign                                            AS  2013_3_sign                         
    ,nd.source_type                                            AS  source_type                         
    ,nd.organize_id                                            AS  organize_id                         
    ,nd.domainFrom                                             AS  domainFrom                          
    ,nd.is_estate                                              AS  is_estate                           
    ,nd.estate_num                                             AS  estate_num                          
    ,nd.is_estate_project                                      AS  is_estate_project                   
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date         
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount       
    ,nd.is_car                                                 AS  is_car                              
    ,nd.car_num                                                AS  car_num                             
    ,nd.is_car_mortgage                                        AS  is_car_mortgage                     
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date           
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount         
    ,nd.is_car_full                                            AS  is_car_full                         
    ,nd.car_full_amaount                                       AS  car_full_amaount                    
    ,nd.by_car_date                                            AS  by_car_date                         
    ,nd.is_business_entity                                     AS  is_business_entity                  
    ,nd.business_entity_water                                  AS  business_entity_water               
    ,nd.is_business_license                                    AS  is_business_license                 
    ,nd.registration_date                                      AS  registration_date                   
    ,nd.no_business_license_date                               AS  no_business_license_date            
    ,nd.is_credit                                              AS  is_credit                           
    ,nd.credit_total_amount                                    AS  credit_total_amount                 
    ,nd.credit_use_amount                                      AS  credit_use_amount                   
    ,nd.is_social_security                                     AS  is_social_security                  
    ,nd.social_security_base                                   AS  social_security_base                
    ,nd.social_security_hand                                   AS  social_security_hand                
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund                
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base              
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand              
    ,nd.is_policy                                              AS  is_policy                           
    ,nd.year_month_pay                                         AS  year_month_pay                      
    ,nd.policy_type                                            AS  policy_type                         
    ,nd.policy_date                                            AS  policy_date                         
    ,nd.policy_amount                                          AS  policy_amount                       
    ,nd.is_history_project                                     AS  is_history_project                  
    ,nd.history_project                                        AS  history_project                     
    ,nd.is_rejected_project                                    AS  is_rejected_project                 
    ,nd.rejected_project_reason                                AS  rejected_project_reason             
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse              
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague           
    ,nd.is_know_project_relative                               AS  is_know_project_relative            
    ,nd.is_know_project_friend                                 AS  is_know_project_friend              
    ,nd.credit_total_overdue                                   AS  credit_total_overdue                
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue           
    ,nd.income_amount                                          AS  income_amount                       
    ,nd.business_entity                                        AS  business_entity                     
    ,nd.flowing                                                AS  flowing                             
    ,nd.nation                                                 AS  nation                              
    ,nd.education                                              AS  education                           
    ,nd.wedlock                                                AS  wedlock                             
    ,nd.income_source                                          AS  income_source                       
    ,nd.is_children                                            AS  is_children                         
    ,nd.is_verify                                              AS  is_verify                           
    ,nd.verify_user_id                                         AS  verify_user_id                      
    ,nd.verify_date                                            AS  verify_date                         
    ,nd.profession                                             AS  profession                          
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id                
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name              
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id                
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name              
    ,nd.purchase_type                                          AS  purchase_type                       
    ,nd.from_channels1_id                                      AS  from_channels1_id                   
    ,nd.from_channels1_name                                    AS  from_channels1_name                 
    ,nd.from_channels2_id                                      AS  from_channels2_id                   
    ,nd.from_channels2_name                                    AS  from_channels2_name                 
    ,nd.create_type                                            AS  create_type                         
    ,nd.assigned_user_id_bak                                   AS  assigned_user_id_bak                
    ,nd.assigned_dept_id_bak                                   AS  assigned_dept_id_bak                
    ,nd.idcardno_address                                       AS  idcardno_address                    

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_bj
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
INNER JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    ##--修改数据:ND表和OD表主键一致，除主键字段外，其他任一字段不一致
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）
AND CONCAT_WS(
               '|@|'
              ,nd.name                                     
              ,nd.date_entered                             
              ,nd.date_modified                            
              ,nd.modified_user_id                         
              ,nd.assigned_user_id                         
              ,nd.created_by                               
              ,nd.description                              
              ,nd.deleted                                  
              ,nd.assigned_dept_id                         
              ,nd.readed_sign                              
              ,nd.assigned_user_time                       
              ,nd.first_name                               
              ,nd.last_name                                
              ,nd.gender                                   
              ,nd.company                                  
              ,nd.search_code                              
              ,nd.phone_mobile1                            
              ,nd.phone_mobile2                            
              ,nd.phone_home1_code                         
              ,nd.phone_home1                              
              ,nd.phone_home1_no                           
              ,nd.phone_home2_code                         
              ,nd.phone_home2                              
              ,nd.phone_home2_no                           
              ,nd.phone_fax_code                           
              ,nd.phone_fax                                
              ,nd.phone_fax_no                             
              ,nd.qq                                       
              ,nd.mail_address                             
              ,nd.msn                                      
              ,nd.primary_address_street                   
              ,nd.primary_address_city                     
              ,nd.primary_address_zone                     
              ,nd.primary_address_plot                     
              ,nd.alt_address_street                       
              ,nd.alt_address_city                         
              ,nd.alt_address_zone                         
              ,nd.alt_address_plot                         
              ,nd.going                                    
              ,nd.birthdate                                
              ,nd.idcardno                                 
              ,nd.credit_status                            
              ,nd.credit_desc                              
              ,nd.flowing_water                            
              ,nd.industry                                 
              ,nd.area                                     
              ,nd.registration_time                        
              ,nd.operation_time                           
              ,nd.year_income                              
              ,nd.profit_rate                              
              ,nd.stock_value                              
              ,nd.account_source1                          
              ,nd.account_source2                          
              ,nd.campaign_id                              
              ,nd.parent_type                              
              ,nd.parent_id                                
              ,nd.account_value                            
              ,nd.life_cycle                               
              ,nd.date_cycle_start                         
              ,nd.second_sales_possibility                 
              ,nd.maintenance_policy                       
              ,nd.status                                   
              ,nd.recent_stranded_date                     
              ,nd.first_call_datetime                      
              ,nd.first_meeting_datetime                   
              ,nd.last_call_datetime                       
              ,nd.last_meeting_datetime                    
              ,nd.next_call_datetime                       
              ,nd.next_meeting_datetime                    
              ,nd.next_contact_datetime                    
              ,nd.total_call_count                         
              ,nd.total_meeting_count                      
              ,nd.final_contact_datetime                   
              ,nd.info_deadline                            
              ,nd.manager_deadline                         
              ,nd.change_manager_deadline                  
              ,nd.dept_deadline                            
              ,nd.lifecycle_deadline                       
              ,nd.accountinfo_completeness_sign            
              ,nd.opptinfo_completeness_sign               
              ,nd.number                                   
              ,nd.property_prove                           
              ,nd.stranded_user_id                         
              ,nd.initial_user_id                          
              ,nd.initial_dept_id                          
              ,nd.change_times                             
              ,nd.main_number_field                        
              ,nd.unicode_id                               
              ,nd.is_private                               
              ,nd.cancel_sign                              
              ,nd.date_created                             
              ,nd.activation_count                         
              ,nd.boss_sign                                
              ,nd.cti_last_callin_datetime                 
              ,nd.cti_last_callout_datetime                
              ,nd.cti_contact_deadline                     
              ,nd.contact_policy                           
              ,nd.is_recovery                              
              ,nd.2013_3_sign                              
              ,nd.source_type                              
              ,nd.organize_id                              
              ,nd.domainFrom                               
              ,nd.is_estate                                
              ,nd.estate_num                               
              ,nd.is_estate_project                        
              ,nd.monthly_house_payments_date              
              ,nd.monthly_house_payments_amount            
              ,nd.is_car                                   
              ,nd.car_num                                  
              ,nd.is_car_mortgage                          
              ,nd.monthly_car_payments_date                
              ,nd.monthly_car_payments_amount              
              ,nd.is_car_full                              
              ,nd.car_full_amaount                         
              ,nd.by_car_date                              
              ,nd.is_business_entity                       
              ,nd.business_entity_water                    
              ,nd.is_business_license                      
              ,nd.registration_date                        
              ,nd.no_business_license_date                 
              ,nd.is_credit                                
              ,nd.credit_total_amount                      
              ,nd.credit_use_amount                        
              ,nd.is_social_security                       
              ,nd.social_security_base                     
              ,nd.social_security_hand                     
              ,nd.is_accumulation_fund                     
              ,nd.accumulation_fund_base                   
              ,nd.accumulation_fund_hand                   
              ,nd.is_policy                                
              ,nd.year_month_pay                           
              ,nd.policy_type                              
              ,nd.policy_date                              
              ,nd.policy_amount                            
              ,nd.is_history_project                       
              ,nd.history_project                          
              ,nd.is_rejected_project                      
              ,nd.rejected_project_reason                  
              ,nd.is_know_project_spouse                   
              ,nd.is_know_project_colleague                
              ,nd.is_know_project_relative                 
              ,nd.is_know_project_friend                   
              ,nd.credit_total_overdue                     
              ,nd.credit_continuous_overdue                
              ,nd.income_amount                            
              ,nd.business_entity                          
              ,nd.flowing                                  
              ,nd.nation                                   
              ,nd.education                                
              ,nd.wedlock                                  
              ,nd.income_source                            
              ,nd.is_children                              
              ,nd.is_verify                                
              ,nd.verify_user_id                           
              ,nd.verify_date                              
              ,nd.profession                               
              ,nd.purchase_channel1_id                     
              ,nd.purchase_channel1_name                   
              ,nd.purchase_channel2_id                     
              ,nd.purchase_channel2_name                   
              ,nd.purchase_type                            
              ,nd.from_channels1_id                        
              ,nd.from_channels1_name                      
              ,nd.from_channels2_id                        
              ,nd.from_channels2_name                      
              ,nd.create_type                              
              ,nd.assigned_user_id_bak                     
              ,nd.assigned_dept_id_bak                     
              ,nd.idcardno_address                         
             ) 
 &lt;&gt; CONCAT_WS(
               '|@|'
              ,od.name                                     
              ,od.date_entered                             
              ,od.date_modified                            
              ,od.modified_user_id                         
              ,od.assigned_user_id                         
              ,od.created_by                               
              ,od.description                              
              ,od.deleted                                  
              ,od.assigned_dept_id                         
              ,od.readed_sign                              
              ,od.assigned_user_time                       
              ,od.first_name                               
              ,od.last_name                                
              ,od.gender                                   
              ,od.company                                  
              ,od.search_code                              
              ,od.phone_mobile1                            
              ,od.phone_mobile2                            
              ,od.phone_home1_code                         
              ,od.phone_home1                              
              ,od.phone_home1_no                           
              ,od.phone_home2_code                         
              ,od.phone_home2                              
              ,od.phone_home2_no                           
              ,od.phone_fax_code                           
              ,od.phone_fax                                
              ,od.phone_fax_no                             
              ,od.qq                                       
              ,od.mail_address                             
              ,od.msn                                      
              ,od.primary_address_street                   
              ,od.primary_address_city                     
              ,od.primary_address_zone                     
              ,od.primary_address_plot                     
              ,od.alt_address_street                       
              ,od.alt_address_city                         
              ,od.alt_address_zone                         
              ,od.alt_address_plot                         
              ,od.going                                    
              ,od.birthdate                                
              ,od.idcardno                                 
              ,od.credit_status                            
              ,od.credit_desc                              
              ,od.flowing_water                            
              ,od.industry                                 
              ,od.area                                     
              ,od.registration_time                        
              ,od.operation_time                           
              ,od.year_income                              
              ,od.profit_rate                              
              ,od.stock_value                              
              ,od.account_source1                          
              ,od.account_source2                          
              ,od.campaign_id                              
              ,od.parent_type                              
              ,od.parent_id                                
              ,od.account_value                            
              ,od.life_cycle                               
              ,od.date_cycle_start                         
              ,od.second_sales_possibility                 
              ,od.maintenance_policy                       
              ,od.status                                   
              ,od.recent_stranded_date                     
              ,od.first_call_datetime                      
              ,od.first_meeting_datetime                   
              ,od.last_call_datetime                       
              ,od.last_meeting_datetime                    
              ,od.next_call_datetime                       
              ,od.next_meeting_datetime                    
              ,od.next_contact_datetime                    
              ,od.total_call_count                         
              ,od.total_meeting_count                      
              ,od.final_contact_datetime                   
              ,od.info_deadline                            
              ,od.manager_deadline                         
              ,od.change_manager_deadline                  
              ,od.dept_deadline                            
              ,od.lifecycle_deadline                       
              ,od.accountinfo_completeness_sign            
              ,od.opptinfo_completeness_sign               
              ,od.number                                   
              ,od.property_prove                           
              ,od.stranded_user_id                         
              ,od.initial_user_id                          
              ,od.initial_dept_id                          
              ,od.change_times                             
              ,od.main_number_field                        
              ,od.unicode_id                               
              ,od.is_private                               
              ,od.cancel_sign                              
              ,od.date_created                             
              ,od.activation_count                         
              ,od.boss_sign                                
              ,od.cti_last_callin_datetime                 
              ,od.cti_last_callout_datetime                
              ,od.cti_contact_deadline                     
              ,od.contact_policy                           
              ,od.is_recovery                              
              ,od.2013_3_sign                              
              ,od.source_type                              
              ,od.organize_id                              
              ,od.domainFrom                               
              ,od.is_estate                                
              ,od.estate_num                               
              ,od.is_estate_project                        
              ,od.monthly_house_payments_date              
              ,od.monthly_house_payments_amount            
              ,od.is_car                                   
              ,od.car_num                                  
              ,od.is_car_mortgage                          
              ,od.monthly_car_payments_date                
              ,od.monthly_car_payments_amount              
              ,od.is_car_full                              
              ,od.car_full_amaount                         
              ,od.by_car_date                              
              ,od.is_business_entity                       
              ,od.business_entity_water                    
              ,od.is_business_license                      
              ,od.registration_date                        
              ,od.no_business_license_date                 
              ,od.is_credit                                
              ,od.credit_total_amount                      
              ,od.credit_use_amount                        
              ,od.is_social_security                       
              ,od.social_security_base                     
              ,od.social_security_hand                     
              ,od.is_accumulation_fund                     
              ,od.accumulation_fund_base                   
              ,od.accumulation_fund_hand                   
              ,od.is_policy                                
              ,od.year_month_pay                           
              ,od.policy_type                              
              ,od.policy_date                              
              ,od.policy_amount                            
              ,od.is_history_project                       
              ,od.history_project                          
              ,od.is_rejected_project                      
              ,od.rejected_project_reason                  
              ,od.is_know_project_spouse                   
              ,od.is_know_project_colleague                
              ,od.is_know_project_relative                 
              ,od.is_know_project_friend                   
              ,od.credit_total_overdue                     
              ,od.credit_continuous_overdue                
              ,od.income_amount                            
              ,od.business_entity                          
              ,od.flowing                                  
              ,od.nation                                   
              ,od.education                                
              ,od.wedlock                                  
              ,od.income_source                            
              ,od.is_children                              
              ,od.is_verify                                
              ,od.verify_user_id                           
              ,od.verify_date                              
              ,od.profession                               
              ,od.purchase_channel1_id                     
              ,od.purchase_channel1_name                   
              ,od.purchase_channel2_id                     
              ,od.purchase_channel2_name                   
              ,od.purchase_type                            
              ,od.from_channels1_id                        
              ,od.from_channels1_name                      
              ,od.from_channels2_id                        
              ,od.from_channels2_name                      
              ,od.create_type                              
              ,od.assigned_user_id_bak                     
              ,od.assigned_dept_id_bak                     
              ,od.idcardno_address                         
             )
;

##----[STEP2.4] - CRM_WH库修改数据写入SDA_CRM_ACCOUNTS_H_UPD表
INSERT INTO sda_crm_accounts_h_upd
(
    ##--固定字段：op_time,sda_end_date,system_id
     op_time                               
    ,sda_end_date
    
    ##--可配置字段：ND表与OD表共有字段
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,idcardno_address
)
SELECT 
    
    ##--固定字段：op_time,sda_end_date,system_id
     nd.op_time                                                AS  op_time                           
    ,'20990101'                                                AS  sda_end_date                    
    
    ##--可配置字段：ND表与OD表共有字段
    ,nd.id                                                     AS  id                                
    ,nd.name                                                   AS  name                              
    ,nd.date_entered                                           AS  date_entered                      
    ,nd.date_modified                                          AS  date_modified                     
    ,nd.modified_user_id                                       AS  modified_user_id                  
    ,nd.assigned_user_id                                       AS  assigned_user_id                  
    ,nd.created_by                                             AS  created_by                        
    ,nd.description                                            AS  description                       
    ,nd.deleted                                                AS  deleted                           
    ,nd.assigned_dept_id                                       AS  assigned_dept_id                  
    ,nd.readed_sign                                            AS  readed_sign                       
    ,nd.assigned_user_time                                     AS  assigned_user_time                
    ,nd.first_name                                             AS  first_name                        
    ,nd.last_name                                              AS  last_name                         
    ,nd.gender                                                 AS  gender                            
    ,nd.company                                                AS  company                           
    ,nd.search_code                                            AS  search_code                       
    ,nd.phone_mobile1                                          AS  phone_mobile1                     
    ,nd.phone_mobile2                                          AS  phone_mobile2                     
    ,nd.phone_home1_code                                       AS  phone_home1_code                  
    ,nd.phone_home1                                            AS  phone_home1                       
    ,nd.phone_home1_no                                         AS  phone_home1_no                    
    ,nd.phone_home2_code                                       AS  phone_home2_code                  
    ,nd.phone_home2                                            AS  phone_home2                       
    ,nd.phone_home2_no                                         AS  phone_home2_no                    
    ,nd.phone_fax_code                                         AS  phone_fax_code                    
    ,nd.phone_fax                                              AS  phone_fax                         
    ,nd.phone_fax_no                                           AS  phone_fax_no                      
    ,nd.qq                                                     AS  qq                                
    ,nd.mail_address                                           AS  mail_address                      
    ,nd.msn                                                    AS  msn                               
    ,nd.primary_address_street                                 AS  primary_address_street            
    ,nd.primary_address_city                                   AS  primary_address_city              
    ,nd.primary_address_zone                                   AS  primary_address_zone              
    ,nd.primary_address_plot                                   AS  primary_address_plot              
    ,nd.alt_address_street                                     AS  alt_address_street                
    ,nd.alt_address_city                                       AS  alt_address_city                  
    ,nd.alt_address_zone                                       AS  alt_address_zone                  
    ,nd.alt_address_plot                                       AS  alt_address_plot                  
    ,nd.going                                                  AS  going                             
    ,nd.birthdate                                              AS  birthdate                         
    ,nd.idcardno                                               AS  idcardno                          
    ,nd.credit_status                                          AS  credit_status                     
    ,nd.credit_desc                                            AS  credit_desc                       
    ,nd.flowing_water                                          AS  flowing_water                     
    ,nd.industry                                               AS  industry                          
    ,nd.area                                                   AS  area                              
    ,nd.registration_time                                      AS  registration_time                 
    ,nd.operation_time                                         AS  operation_time                    
    ,nd.year_income                                            AS  year_income                       
    ,nd.profit_rate                                            AS  profit_rate                       
    ,nd.stock_value                                            AS  stock_value                       
    ,nd.account_source1                                        AS  account_source1                   
    ,nd.account_source2                                        AS  account_source2                   
    ,nd.campaign_id                                            AS  campaign_id                       
    ,nd.parent_type                                            AS  parent_type                       
    ,nd.parent_id                                              AS  parent_id                         
    ,nd.account_value                                          AS  account_value                     
    ,nd.life_cycle                                             AS  life_cycle                        
    ,nd.date_cycle_start                                       AS  date_cycle_start                  
    ,nd.second_sales_possibility                               AS  second_sales_possibility          
    ,nd.maintenance_policy                                     AS  maintenance_policy                
    ,nd.status                                                 AS  status                            
    ,nd.recent_stranded_date                                   AS  recent_stranded_date              
    ,nd.first_call_datetime                                    AS  first_call_datetime               
    ,nd.first_meeting_datetime                                 AS  first_meeting_datetime            
    ,nd.last_call_datetime                                     AS  last_call_datetime                
    ,nd.last_meeting_datetime                                  AS  last_meeting_datetime             
    ,nd.next_call_datetime                                     AS  next_call_datetime                
    ,nd.next_meeting_datetime                                  AS  next_meeting_datetime             
    ,nd.next_contact_datetime                                  AS  next_contact_datetime             
    ,nd.total_call_count                                       AS  total_call_count                  
    ,nd.total_meeting_count                                    AS  total_meeting_count               
    ,nd.final_contact_datetime                                 AS  final_contact_datetime            
    ,nd.info_deadline                                          AS  info_deadline                     
    ,nd.manager_deadline                                       AS  manager_deadline                  
    ,nd.change_manager_deadline                                AS  change_manager_deadline           
    ,nd.dept_deadline                                          AS  dept_deadline                     
    ,nd.lifecycle_deadline                                     AS  lifecycle_deadline                
    ,nd.accountinfo_completeness_sign                          AS  accountinfo_completeness_sign     
    ,nd.opptinfo_completeness_sign                             AS  opptinfo_completeness_sign        
    ,nd.number                                                 AS  number                            
    ,nd.property_prove                                         AS  property_prove                    
    ,nd.stranded_user_id                                       AS  stranded_user_id                  
    ,nd.initial_user_id                                        AS  initial_user_id                   
    ,nd.initial_dept_id                                        AS  initial_dept_id                   
    ,nd.change_times                                           AS  change_times                      
    ,nd.main_number_field                                      AS  main_number_field                 
    ,nd.unicode_id                                             AS  unicode_id                        
    ,nd.is_private                                             AS  is_private                        
    ,nd.cancel_sign                                            AS  cancel_sign                       
    ,nd.date_created                                           AS  date_created                      
    ,nd.activation_count                                       AS  activation_count                  
    ,nd.boss_sign                                              AS  boss_sign                         
    ,nd.cti_last_callin_datetime                               AS  cti_last_callin_datetime          
    ,nd.cti_last_callout_datetime                              AS  cti_last_callout_datetime         
    ,nd.cti_contact_deadline                                   AS  cti_contact_deadline              
    ,nd.contact_policy                                         AS  contact_policy                    
    ,nd.is_recovery                                            AS  is_recovery                       
    ,nd.2013_3_sign                                            AS  2013_3_sign                       
    ,nd.source_type                                            AS  source_type                       
    ,nd.organize_id                                            AS  organize_id                       
    ,nd.domainFrom                                             AS  domainFrom                        
    ,nd.is_estate                                              AS  is_estate                         
    ,nd.estate_num                                             AS  estate_num                        
    ,nd.is_estate_project                                      AS  is_estate_project                 
    ,nd.monthly_house_payments_date                            AS  monthly_house_payments_date       
    ,nd.monthly_house_payments_amount                          AS  monthly_house_payments_amount     
    ,nd.is_car                                                 AS  is_car                            
    ,nd.car_num                                                AS  car_num                           
    ,nd.is_car_mortgage                                        AS  is_car_mortgage                   
    ,nd.monthly_car_payments_date                              AS  monthly_car_payments_date         
    ,nd.monthly_car_payments_amount                            AS  monthly_car_payments_amount       
    ,nd.is_car_full                                            AS  is_car_full                       
    ,nd.car_full_amaount                                       AS  car_full_amaount                  
    ,nd.by_car_date                                            AS  by_car_date                       
    ,nd.is_business_entity                                     AS  is_business_entity                
    ,nd.business_entity_water                                  AS  business_entity_water             
    ,nd.is_business_license                                    AS  is_business_license               
    ,nd.registration_date                                      AS  registration_date                 
    ,nd.no_business_license_date                               AS  no_business_license_date          
    ,nd.is_credit                                              AS  is_credit                         
    ,nd.credit_total_amount                                    AS  credit_total_amount               
    ,nd.credit_use_amount                                      AS  credit_use_amount                 
    ,nd.is_social_security                                     AS  is_social_security                
    ,nd.social_security_base                                   AS  social_security_base              
    ,nd.social_security_hand                                   AS  social_security_hand              
    ,nd.is_accumulation_fund                                   AS  is_accumulation_fund              
    ,nd.accumulation_fund_base                                 AS  accumulation_fund_base            
    ,nd.accumulation_fund_hand                                 AS  accumulation_fund_hand            
    ,nd.is_policy                                              AS  is_policy                         
    ,nd.year_month_pay                                         AS  year_month_pay                    
    ,nd.policy_type                                            AS  policy_type                       
    ,nd.policy_date                                            AS  policy_date                       
    ,nd.policy_amount                                          AS  policy_amount                     
    ,nd.is_history_project                                     AS  is_history_project                
    ,nd.history_project                                        AS  history_project                   
    ,nd.is_rejected_project                                    AS  is_rejected_project               
    ,nd.rejected_project_reason                                AS  rejected_project_reason           
    ,nd.is_know_project_spouse                                 AS  is_know_project_spouse            
    ,nd.is_know_project_colleague                              AS  is_know_project_colleague         
    ,nd.is_know_project_relative                               AS  is_know_project_relative          
    ,nd.is_know_project_friend                                 AS  is_know_project_friend            
    ,nd.credit_total_overdue                                   AS  credit_total_overdue              
    ,nd.credit_continuous_overdue                              AS  credit_continuous_overdue         
    ,nd.income_amount                                          AS  income_amount                     
    ,nd.business_entity                                        AS  business_entity                   
    ,nd.flowing                                                AS  flowing                           
    ,nd.nation                                                 AS  nation                            
    ,nd.education                                              AS  education                         
    ,nd.wedlock                                                AS  wedlock                           
    ,nd.income_source                                          AS  income_source                     
    ,nd.is_children                                            AS  is_children                       
    ,nd.is_verify                                              AS  is_verify                         
    ,nd.verify_user_id                                         AS  verify_user_id                    
    ,nd.verify_date                                            AS  verify_date                       
    ,nd.profession                                             AS  profession                        
    ,nd.purchase_channel1_id                                   AS  purchase_channel1_id              
    ,nd.purchase_channel1_name                                 AS  purchase_channel1_name            
    ,nd.purchase_channel2_id                                   AS  purchase_channel2_id              
    ,nd.purchase_channel2_name                                 AS  purchase_channel2_name            
    ,nd.purchase_type                                          AS  purchase_type                     
    ,nd.from_channels1_id                                      AS  from_channels1_id                 
    ,nd.from_channels1_name                                    AS  from_channels1_name               
    ,nd.from_channels2_id                                      AS  from_channels2_id                 
    ,nd.from_channels2_name                                    AS  from_channels2_name               
    ,nd.create_type                                            AS  create_type                       
    ,nd.idcardno_address                                       AS  idcardno_address                  

FROM
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_wh
     WHERE
         op_time = ${op_time}
    ) nd                                                       ##--ND(New Data)表为STA层当日抽取数据
         
INNER JOIN
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据
      
ON  
    ##--修改数据:ND表和OD表主键一致，除主键字段外，其他任一字段不一致
    nd.id = od.id                                              ##--关联字段：物理主键或逻辑主键（注意：若ND表的关联主键有重复，可在ND子查询中加distinct或使用其他方式去重）
AND CONCAT_WS(
               '|@|'
              ,nd.name                              
              ,nd.date_entered                      
              ,nd.date_modified                     
              ,nd.modified_user_id                  
              ,nd.assigned_user_id                  
              ,nd.created_by                        
              ,nd.description                       
              ,nd.deleted                           
              ,nd.assigned_dept_id                  
              ,nd.readed_sign                       
              ,nd.assigned_user_time                
              ,nd.first_name                        
              ,nd.last_name                         
              ,nd.gender                            
              ,nd.company                           
              ,nd.search_code                       
              ,nd.phone_mobile1                     
              ,nd.phone_mobile2                     
              ,nd.phone_home1_code                  
              ,nd.phone_home1                       
              ,nd.phone_home1_no                    
              ,nd.phone_home2_code                  
              ,nd.phone_home2                       
              ,nd.phone_home2_no                    
              ,nd.phone_fax_code                    
              ,nd.phone_fax                         
              ,nd.phone_fax_no                      
              ,nd.qq                                
              ,nd.mail_address                      
              ,nd.msn                               
              ,nd.primary_address_street            
              ,nd.primary_address_city              
              ,nd.primary_address_zone              
              ,nd.primary_address_plot              
              ,nd.alt_address_street                
              ,nd.alt_address_city                  
              ,nd.alt_address_zone                  
              ,nd.alt_address_plot                  
              ,nd.going                             
              ,nd.birthdate                         
              ,nd.idcardno                          
              ,nd.credit_status                     
              ,nd.credit_desc                       
              ,nd.flowing_water                     
              ,nd.industry                          
              ,nd.area                              
              ,nd.registration_time                 
              ,nd.operation_time                    
              ,nd.year_income                       
              ,nd.profit_rate                       
              ,nd.stock_value                       
              ,nd.account_source1                   
              ,nd.account_source2                   
              ,nd.campaign_id                       
              ,nd.parent_type                       
              ,nd.parent_id                         
              ,nd.account_value                     
              ,nd.life_cycle                        
              ,nd.date_cycle_start                  
              ,nd.second_sales_possibility          
              ,nd.maintenance_policy                
              ,nd.status                            
              ,nd.recent_stranded_date              
              ,nd.first_call_datetime               
              ,nd.first_meeting_datetime            
              ,nd.last_call_datetime                
              ,nd.last_meeting_datetime             
              ,nd.next_call_datetime                
              ,nd.next_meeting_datetime             
              ,nd.next_contact_datetime             
              ,nd.total_call_count                  
              ,nd.total_meeting_count               
              ,nd.final_contact_datetime            
              ,nd.info_deadline                     
              ,nd.manager_deadline                  
              ,nd.change_manager_deadline           
              ,nd.dept_deadline                     
              ,nd.lifecycle_deadline                
              ,nd.accountinfo_completeness_sign     
              ,nd.opptinfo_completeness_sign        
              ,nd.number                            
              ,nd.property_prove                    
              ,nd.stranded_user_id                  
              ,nd.initial_user_id                   
              ,nd.initial_dept_id                   
              ,nd.change_times                      
              ,nd.main_number_field                 
              ,nd.unicode_id                        
              ,nd.is_private                        
              ,nd.cancel_sign                       
              ,nd.date_created                      
              ,nd.activation_count                  
              ,nd.boss_sign                         
              ,nd.cti_last_callin_datetime          
              ,nd.cti_last_callout_datetime         
              ,nd.cti_contact_deadline              
              ,nd.contact_policy                    
              ,nd.is_recovery                       
              ,nd.2013_3_sign                       
              ,nd.source_type                       
              ,nd.organize_id                       
              ,nd.domainFrom                        
              ,nd.is_estate                         
              ,nd.estate_num                        
              ,nd.is_estate_project                 
              ,nd.monthly_house_payments_date       
              ,nd.monthly_house_payments_amount     
              ,nd.is_car                            
              ,nd.car_num                           
              ,nd.is_car_mortgage                   
              ,nd.monthly_car_payments_date         
              ,nd.monthly_car_payments_amount       
              ,nd.is_car_full                       
              ,nd.car_full_amaount                  
              ,nd.by_car_date                       
              ,nd.is_business_entity                
              ,nd.business_entity_water             
              ,nd.is_business_license               
              ,nd.registration_date                 
              ,nd.no_business_license_date          
              ,nd.is_credit                         
              ,nd.credit_total_amount               
              ,nd.credit_use_amount                 
              ,nd.is_social_security                
              ,nd.social_security_base              
              ,nd.social_security_hand              
              ,nd.is_accumulation_fund              
              ,nd.accumulation_fund_base            
              ,nd.accumulation_fund_hand            
              ,nd.is_policy                         
              ,nd.year_month_pay                    
              ,nd.policy_type                       
              ,nd.policy_date                       
              ,nd.policy_amount                     
              ,nd.is_history_project                
              ,nd.history_project                   
              ,nd.is_rejected_project               
              ,nd.rejected_project_reason           
              ,nd.is_know_project_spouse            
              ,nd.is_know_project_colleague         
              ,nd.is_know_project_relative          
              ,nd.is_know_project_friend            
              ,nd.credit_total_overdue              
              ,nd.credit_continuous_overdue         
              ,nd.income_amount                     
              ,nd.business_entity                   
              ,nd.flowing                           
              ,nd.nation                            
              ,nd.education                         
              ,nd.wedlock                           
              ,nd.income_source                     
              ,nd.is_children                       
              ,nd.is_verify                         
              ,nd.verify_user_id                    
              ,nd.verify_date                       
              ,nd.profession                        
              ,nd.purchase_channel1_id              
              ,nd.purchase_channel1_name            
              ,nd.purchase_channel2_id              
              ,nd.purchase_channel2_name            
              ,nd.purchase_type                     
              ,nd.from_channels1_id                 
              ,nd.from_channels1_name               
              ,nd.from_channels2_id                 
              ,nd.from_channels2_name               
              ,nd.create_type                       
              ,nd.idcardno_address 
             ) 
 &lt;&gt; CONCAT_WS(
               '|@|'
              ,od.name                              
              ,od.date_entered                      
              ,od.date_modified                     
              ,od.modified_user_id                  
              ,od.assigned_user_id                  
              ,od.created_by                        
              ,od.description                       
              ,od.deleted                           
              ,od.assigned_dept_id                  
              ,od.readed_sign                       
              ,od.assigned_user_time                
              ,od.first_name                        
              ,od.last_name                         
              ,od.gender                            
              ,od.company                           
              ,od.search_code                       
              ,od.phone_mobile1                     
              ,od.phone_mobile2                     
              ,od.phone_home1_code                  
              ,od.phone_home1                       
              ,od.phone_home1_no                    
              ,od.phone_home2_code                  
              ,od.phone_home2                       
              ,od.phone_home2_no                    
              ,od.phone_fax_code                    
              ,od.phone_fax                         
              ,od.phone_fax_no                      
              ,od.qq                                
              ,od.mail_address                      
              ,od.msn                               
              ,od.primary_address_street            
              ,od.primary_address_city              
              ,od.primary_address_zone              
              ,od.primary_address_plot              
              ,od.alt_address_street                
              ,od.alt_address_city                  
              ,od.alt_address_zone                  
              ,od.alt_address_plot                  
              ,od.going                             
              ,od.birthdate                         
              ,od.idcardno                          
              ,od.credit_status                     
              ,od.credit_desc                       
              ,od.flowing_water                     
              ,od.industry                          
              ,od.area                              
              ,od.registration_time                 
              ,od.operation_time                    
              ,od.year_income                       
              ,od.profit_rate                       
              ,od.stock_value                       
              ,od.account_source1                   
              ,od.account_source2                   
              ,od.campaign_id                       
              ,od.parent_type                       
              ,od.parent_id                         
              ,od.account_value                     
              ,od.life_cycle                        
              ,od.date_cycle_start                  
              ,od.second_sales_possibility          
              ,od.maintenance_policy                
              ,od.status                            
              ,od.recent_stranded_date              
              ,od.first_call_datetime               
              ,od.first_meeting_datetime            
              ,od.last_call_datetime                
              ,od.last_meeting_datetime             
              ,od.next_call_datetime                
              ,od.next_meeting_datetime             
              ,od.next_contact_datetime             
              ,od.total_call_count                  
              ,od.total_meeting_count               
              ,od.final_contact_datetime            
              ,od.info_deadline                     
              ,od.manager_deadline                  
              ,od.change_manager_deadline           
              ,od.dept_deadline                     
              ,od.lifecycle_deadline                
              ,od.accountinfo_completeness_sign     
              ,od.opptinfo_completeness_sign        
              ,od.number                            
              ,od.property_prove                    
              ,od.stranded_user_id                  
              ,od.initial_user_id                   
              ,od.initial_dept_id                   
              ,od.change_times                      
              ,od.main_number_field                 
              ,od.unicode_id                        
              ,od.is_private                        
              ,od.cancel_sign                       
              ,od.date_created                      
              ,od.activation_count                  
              ,od.boss_sign                         
              ,od.cti_last_callin_datetime          
              ,od.cti_last_callout_datetime         
              ,od.cti_contact_deadline              
              ,od.contact_policy                    
              ,od.is_recovery                       
              ,od.2013_3_sign                       
              ,od.source_type                       
              ,od.organize_id                       
              ,od.domainFrom                        
              ,od.is_estate                         
              ,od.estate_num                        
              ,od.is_estate_project                 
              ,od.monthly_house_payments_date       
              ,od.monthly_house_payments_amount     
              ,od.is_car                            
              ,od.car_num                           
              ,od.is_car_mortgage                   
              ,od.monthly_car_payments_date         
              ,od.monthly_car_payments_amount       
              ,od.is_car_full                       
              ,od.car_full_amaount                  
              ,od.by_car_date                       
              ,od.is_business_entity                
              ,od.business_entity_water             
              ,od.is_business_license               
              ,od.registration_date                 
              ,od.no_business_license_date          
              ,od.is_credit                         
              ,od.credit_total_amount               
              ,od.credit_use_amount                 
              ,od.is_social_security                
              ,od.social_security_base              
              ,od.social_security_hand              
              ,od.is_accumulation_fund              
              ,od.accumulation_fund_base            
              ,od.accumulation_fund_hand            
              ,od.is_policy                         
              ,od.year_month_pay                    
              ,od.policy_type                       
              ,od.policy_date                       
              ,od.policy_amount                     
              ,od.is_history_project                
              ,od.history_project                   
              ,od.is_rejected_project               
              ,od.rejected_project_reason           
              ,od.is_know_project_spouse            
              ,od.is_know_project_colleague         
              ,od.is_know_project_relative          
              ,od.is_know_project_friend            
              ,od.credit_total_overdue              
              ,od.credit_continuous_overdue         
              ,od.income_amount                     
              ,od.business_entity                   
              ,od.flowing                           
              ,od.nation                            
              ,od.education                         
              ,od.wedlock                           
              ,od.income_source                     
              ,od.is_children                       
              ,od.is_verify                         
              ,od.verify_user_id                    
              ,od.verify_date                       
              ,od.profession                        
              ,od.purchase_channel1_id              
              ,od.purchase_channel1_name            
              ,od.purchase_channel2_id              
              ,od.purchase_channel2_name            
              ,od.purchase_type                     
              ,od.from_channels1_id                 
              ,od.from_channels1_name               
              ,od.from_channels2_id                 
              ,od.from_channels2_name               
              ,od.create_type                       
              ,od.idcardno_address 
             )
;
</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename />
      <sendOneStatement>F</sendOneStatement>
      <connection>conn_edw</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>384</xloc>
      <yloc>144</yloc>
    </entry>
    <entry>
      <name>[STEP3]:识别当日删除数据</name>
      <description />
      <type>SQL</type>
      <sql>##--[STEP3]:识别当日删除数据 - 创建临时表SDA_CRM_ACCOUNTS_H_DEL，存储当日删除数据

##----[STEP3.1] - 创建临时表SDA_CRM_ACCOUNTS_H_DEL
DROP TABLE IF EXISTS sda_crm_accounts_h_del;
CREATE TABLE sda_crm_accounts_h_del LIKE sda_crm_accounts_h;

##----[STEP3.2] - 删除数据写入SDA_CRM_ACCOUNTS_H_DEL表
INSERT INTO sda_crm_accounts_h_del
(
     op_time
    ,id
)
SELECT
     od.op_time                                           AS op_time
    ,od.id                                                AS id

FROM
    (
     SELECT
         *
     FROM
         sda_crm_accounts_h
     WHERE
         1 = 1                                                 ##--“1=1”：STA层为全量抽取，可识别删除数据；“0=1”：STA层为全量抽取，不可识别删除数据
     AND op_time &lt; ${op_time}
     AND sda_end_date >= ${op_time}
     
    ) od                                                       ##--OD(Old Data)表为SDA层截止昨日的历史数据

LEFT JOIN
    (
     SELECT 
         *
     FROM
         sta_crm_accounts_cd
     WHERE
         op_time = ${op_time}
    ) nd1                                                      ##--ND1(New Data)表为STA层CRM_CD库当日抽取数据
ON  
    od.id = nd1.id
         
WHERE
    ##--OD有,且ND1\ND2\ND3均无：即为删除数据
    nd1.id IS NULL
;</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename />
      <sendOneStatement>F</sendOneStatement>
      <connection>conn_edw</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>560</xloc>
      <yloc>144</yloc>
    </entry>
    <entry>
      <name>[STEP4]:设置重跑还原点</name>
      <description />
      <type>SQL</type>
      <sql>##--[STEP4]:设置重跑还原点

##----[STEP4.1] - 删除当日及之后的数据版本
DELETE
FROM
    sda_crm_accounts_h
WHERE 
    op_time >= ${op_time}
;

##----[STEP4.2] - 恢复当日及之后失效的数据版本
UPDATE
    sda_crm_accounts_h a
SET
    a.sda_end_date = 20990101
WHERE 
    a.op_time &lt; ${op_time}
AND a.sda_end_date >= ${op_time}
AND a.sda_end_date &lt; 20990101
;
</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename />
      <sendOneStatement>F</sendOneStatement>
      <connection>conn_edw</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>704</xloc>
      <yloc>144</yloc>
    </entry>
    <entry>
      <name>[STEP5]:数据拉链</name>
      <description />
      <type>SQL</type>
      <sql>##--[STEP5]:数据拉链：当日变更数据（增删改）与历史存量数据拉链合并

##----[STEP5.1] - 已删除数据关链
UPDATE 
    sda_crm_accounts_h od
SET
    od.sda_end_date = ${op_time}
WHERE
    od.op_time &lt; ${op_time}
AND od.sda_end_date >= ${op_time}
AND EXISTS (
            SELECT 1 
              FROM sda_crm_accounts_h_del del
             WHERE od.op_time = del.op_time
               AND od.id = del.id
           )
;

##----[STEP5.2] - 已修改数据的历史版本关链
UPDATE 
    sda_crm_accounts_h od
SET
    od.sda_end_date = ${op_time}
WHERE
    od.op_time &lt; ${op_time}
AND od.sda_end_date >= ${op_time}
AND EXISTS (
            SELECT 1 
              FROM sda_crm_accounts_h_upd upd
               AND od.id = upd.id
           )
;

##----[STEP5.3] - 已修改数据的最新版本开链
INSERT INTO sda_crm_accounts_h
(
     op_time
    ,sda_end_date
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,assigned_user_id_bak
    ,assigned_dept_id_bak
    ,idcardno_address
)
SELECT
     op_time
    ,sda_end_date
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,assigned_user_id_bak
    ,assigned_dept_id_bak
    ,idcardno_address
FROM 
    sda_crm_accounts_h_upd
;

##----[STEP5.4] - 新增数据的最新版本开链
INSERT INTO sda_crm_accounts_h
(
     op_time
    ,sda_end_date
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,assigned_user_id_bak
    ,assigned_dept_id_bak
    ,idcardno_address
)
SELECT
     op_time
    ,sda_end_date
    ,id
    ,name
    ,date_entered
    ,date_modified
    ,modified_user_id
    ,assigned_user_id
    ,created_by
    ,description
    ,deleted
    ,assigned_dept_id
    ,readed_sign
    ,assigned_user_time
    ,first_name
    ,last_name
    ,gender
    ,company
    ,search_code
    ,phone_mobile1
    ,phone_mobile2
    ,phone_home1_code
    ,phone_home1
    ,phone_home1_no
    ,phone_home2_code
    ,phone_home2
    ,phone_home2_no
    ,phone_fax_code
    ,phone_fax
    ,phone_fax_no
    ,qq
    ,mail_address
    ,msn
    ,primary_address_street
    ,primary_address_city
    ,primary_address_zone
    ,primary_address_plot
    ,alt_address_street
    ,alt_address_city
    ,alt_address_zone
    ,alt_address_plot
    ,going
    ,birthdate
    ,idcardno
    ,credit_status
    ,credit_desc
    ,flowing_water
    ,industry
    ,area
    ,registration_time
    ,operation_time
    ,year_income
    ,profit_rate
    ,stock_value
    ,account_source1
    ,account_source2
    ,campaign_id
    ,parent_type
    ,parent_id
    ,account_value
    ,life_cycle
    ,date_cycle_start
    ,second_sales_possibility
    ,maintenance_policy
    ,status
    ,recent_stranded_date
    ,first_call_datetime
    ,first_meeting_datetime
    ,last_call_datetime
    ,last_meeting_datetime
    ,next_call_datetime
    ,next_meeting_datetime
    ,next_contact_datetime
    ,total_call_count
    ,total_meeting_count
    ,final_contact_datetime
    ,info_deadline
    ,manager_deadline
    ,change_manager_deadline
    ,dept_deadline
    ,lifecycle_deadline
    ,accountinfo_completeness_sign
    ,opptinfo_completeness_sign
    ,number
    ,property_prove
    ,stranded_user_id
    ,initial_user_id
    ,initial_dept_id
    ,change_times
    ,main_number_field
    ,unicode_id
    ,is_private
    ,cancel_sign
    ,date_created
    ,activation_count
    ,boss_sign
    ,cti_last_callin_datetime
    ,cti_last_callout_datetime
    ,cti_contact_deadline
    ,contact_policy
    ,is_recovery
    ,2013_3_sign
    ,source_type
    ,organize_id
    ,domainFrom
    ,is_estate
    ,estate_num
    ,is_estate_project
    ,monthly_house_payments_date
    ,monthly_house_payments_amount
    ,is_car
    ,car_num
    ,is_car_mortgage
    ,monthly_car_payments_date
    ,monthly_car_payments_amount
    ,is_car_full
    ,car_full_amaount
    ,by_car_date
    ,is_business_entity
    ,business_entity_water
    ,is_business_license
    ,registration_date
    ,no_business_license_date
    ,is_credit
    ,credit_total_amount
    ,credit_use_amount
    ,is_social_security
    ,social_security_base
    ,social_security_hand
    ,is_accumulation_fund
    ,accumulation_fund_base
    ,accumulation_fund_hand
    ,is_policy
    ,year_month_pay
    ,policy_type
    ,policy_date
    ,policy_amount
    ,is_history_project
    ,history_project
    ,is_rejected_project
    ,rejected_project_reason
    ,is_know_project_spouse
    ,is_know_project_colleague
    ,is_know_project_relative
    ,is_know_project_friend
    ,credit_total_overdue
    ,credit_continuous_overdue
    ,income_amount
    ,business_entity
    ,flowing
    ,nation
    ,education
    ,wedlock
    ,income_source
    ,is_children
    ,is_verify
    ,verify_user_id
    ,verify_date
    ,profession
    ,purchase_channel1_id
    ,purchase_channel1_name
    ,purchase_channel2_id
    ,purchase_channel2_name
    ,purchase_type
    ,from_channels1_id
    ,from_channels1_name
    ,from_channels2_id
    ,from_channels2_name
    ,create_type
    ,assigned_user_id_bak
    ,assigned_dept_id_bak
    ,idcardno_address
FROM 
    sda_crm_accounts_h_ins
;
</sql>
      <useVariableSubstitution>T</useVariableSubstitution>
      <sqlfromfile>F</sqlfromfile>
      <sqlfilename />
      <sendOneStatement>F</sendOneStatement>
      <connection>conn_edw</connection>
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>864</xloc>
      <yloc>144</yloc>
    </entry>
    <entry>
      <name>文件头信息</name>
      <description />
      <type>WRITE_TO_LOG</type>
      <logmessage>#***********************************************************************************
# MoerLong EDW ETL script -- Coding By Kettle
# 任 务 名: sda_crm_accounts_h
# 目 标 表: sda_crm_accounts_h  类型一sda层输出表
# 源 表 名: sta_crm_accountscd, bj, wh  类型一sta层输入表
# 加载策略: [02]sta_crm_accountscd, bj, wh  类型一sta层输入表
# 加载策略: [02] (注,01:直接追加 02:增量拉链,03:全表拉链,04:全表覆盖,05:增量覆盖)
# 运行周期: [1] (注, 1:天,2:星期,3:旬,4:月,5:季,6:半年,7:年，00:其他)
# 脚本功能: 实现ETL加载模板类型一增量拉链方式
# 创建时间: 2018-04-19
# 作    者: jason
# 修改记录: 1、
#
#***********************************************************************************
</logmessage>
      <loglevel>Basic</loglevel>
      <logsubject />
      <parallel>N</parallel>
      <draw>Y</draw>
      <nr>0</nr>
      <xloc>96</xloc>
      <yloc>144</yloc>
    </entry>
  </entries>
  <hops>
    <hop>
      <from>[STEP1]:识别当日新增数据</from>
      <to>[STEP2]:识别当日修改数据</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>[STEP2]:识别当日修改数据</from>
      <to>[STEP3]:识别当日删除数据</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>[STEP3]:识别当日删除数据</from>
      <to>[STEP4]:设置重跑还原点</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>文件头信息</from>
      <to>[STEP1]:识别当日新增数据</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>START</from>
      <to>文件头信息</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>Y</unconditional>
    </hop>
    <hop>
      <from>[STEP4]:设置重跑还原点</from>
      <to>[STEP5]:数据拉链</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
    <hop>
      <from>[STEP5]:数据拉链</from>
      <to>成功</to>
      <from_nr>0</from_nr>
      <to_nr>0</to_nr>
      <enabled>Y</enabled>
      <evaluation>Y</evaluation>
      <unconditional>N</unconditional>
    </hop>
  </hops>
  <notepads>
  </notepads>
  <attributes>
    <group>
      <name>METASTORE.pentaho</name>
      <attribute>
        <key>Default Run Configuration</key>
        <value>{"namespace":"pentaho","id":"Default Run Configuration","name":"Default Run Configuration","description":"Defines a default run configuration","metaStoreName":null}</value>
      </attribute>
    </group>
    <group>
      <name>{"_":"Embedded MetaStore Elements","namespace":"pentaho","type":"Default Run Configuration"}</name>
      <attribute>
        <key>Pentaho local</key>
        <value>{"children":[{"children":[],"id":"server","value":null},{"children":[],"id":"clustered","value":"N"},{"children":[],"id":"name","value":"Pentaho local"},{"children":[],"id":"description","value":null},{"children":[],"id":"readOnly","value":"Y"},{"children":[],"id":"sendResources","value":"N"},{"children":[],"id":"logRemoteExecutionLocally","value":"N"},{"children":[],"id":"remote","value":"N"},{"children":[],"id":"local","value":"Y"},{"children":[],"id":"showTransformations","value":"N"}],"id":"Pentaho local","value":null,"name":"Pentaho local","owner":null,"ownerPermissionsList":[]}</value>
      </attribute>
    </group>
  </attributes>
</job>
